# HubbleNego 製品仕様書兼要件定義書

## 📌 エグゼクティブサマリー

**HubbleNego** は、契約交渉プロセスをシンプルにし、法務知識がなくても契約内容を理解・交渉できる B2B SaaS プロダクトです。

### プロダクトビジョン
> **「契約がわかると、信頼される。」**

AIが契約書を「あなたの言葉」に翻訳し、理解して交渉し、守れる約束を結ぶ。それが次のビジネスを生む。

### 解決する課題
| 課題 | 現状 | HubbleNegoによる解決 |
|------|------|----------------------|
| 契約書が難しい | 法律用語が理解できず、何を約束しているのかわからない | AIが平易な日本語に翻訳、要点を3行でサマリー |
| 交渉に時間がかかる | メールの往復で認識のズレが発生、締結まで長期化 | 同じ画面でリアルタイム交渉、コメント・チャットで即解決 |
| 期日を忘れる | 更新判断期限を見落とし、意図しない自動更新 | タイムラインで可視化、自動リマインド |
| 版管理が混乱 | 「最新版どれ？」問題、変更履歴が追えない | 自動バージョン管理、差分比較機能 |

---

## 🎯 ターゲットユーザー

### プライマリペルソナ
**「契約書を扱う必要があるが、法務の専門家ではないビジネスパーソン」**

- 営業マネージャー（取引先との契約交渉）
- 事業開発担当者（パートナーシップ契約）
- スタートアップ経営者（各種契約を自分で対応）
- フリーランス・個人事業主（業務委託契約）

### セカンダリペルソナ
- 法務担当者（複数の契約を効率的に管理）
- 管理部門担当者（契約期限・支払いの管理）

### ユーザーストーリー
```
私は [営業マネージャー] として、
[新規取引先との契約交渉] を行いたい。
なぜなら [契約内容を正しく理解し、履行できる約束をすることで、信頼関係を構築したい] からだ。
```

---

## 🔄 ユーザーフロー

### メインフロー：契約交渉の開始から合意まで

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                  │
│  [1. アップロード]  →  [2. 招待]  →  [3. 交渉開始]              │
│        │                   │              │                      │
│        ↓                   ↓              ↓                      │
│   契約書を           相手を招待      AI解説を見ながら            │
│   ドラッグ＆         メール or       チャット・コメント          │
│   ドロップ           リンク共有      で交渉                      │
│                                           │                      │
│                                           ↓                      │
│                             [4. 合意]  →  [5. 契約成立]          │
│                                  │              │                │
│                                  ↓              ↓                │
│                           「この内容で      両者合意で           │
│                            合意」ボタン      契約確定             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 招待された側のフロー

```
招待リンクを受信 → 契約書プレビュー確認 → サインイン → 交渉に参加
                     (AI概要表示)      (Google/Microsoft)
```

---

## 🏗️ 機能要件

### 1. 契約書アップロード・管理

#### 1.1 ファイルアップロード
| 項目 | 仕様 |
|------|------|
| 対応形式 | Word (.docx, .doc), PDF |
| アップロード方法 | ドラッグ＆ドロップ / ファイル選択 |
| 複数ファイル | 対応（基本契約書＋個別契約書など） |
| ファイルサイズ上限 | 20MB/ファイル（想定） |

#### 1.2 案件管理
- 案件名の設定・編集
- 案件ごとの契約書グループ管理
- 一覧画面での検索・フィルター

### 2. AI機能

#### 2.1 契約書サマリー（自動生成）
| 機能 | 説明 |
|------|------|
| 要点サマリー | 契約の要点を3行で自動生成 |
| 人・モノ・金の流れ | 当事者間の取引構造を図示 |
| タイムライン | 重要日付（開始・満了・更新判断期限・請求日等）を自動抽出 |
| ハイライト | 金額・期間・責任範囲を自動でマーク |

#### 2.2 AI解説機能
| 機能 | 説明 |
|------|------|
| テキスト選択解説 | 選択した条文を平易な日本語で解説 |
| 注意点の提示 | リスクや注意すべきポイントをアラート表示 |
| 質問応答 | 契約内容についてAIに質問可能（将来機能） |

#### 2.3 AI生成物の表示ルール
- 全てのAI生成コンテンツに「AI生成」バッジを表示
- 「契約書から自動生成されています。内容をご確認ください。」の注記

### 3. リアルタイム交渉機能

#### 3.1 メッセージ（チャット）
| 項目 | 仕様 |
|------|------|
| リアルタイム送受信 | 対応 |
| 送信者表示 | アバター（イニシャル）＋名前＋タイムスタンプ |
| 既読機能 | 将来対応 |
| 通知 | メール通知（新着メッセージ時） |

#### 3.2 コメントスレッド
| 項目 | 仕様 |
|------|------|
| 対象 | 契約書内の任意のテキストに紐付け |
| スレッド形式 | 1コメントに対して複数の返信が可能 |
| 表示 | 契約書本文にコメントアイコン＋件数を表示 |
| アクセス | アイコンクリックでスレッドパネル表示 |

### 4. バージョン管理

#### 4.1 自動バージョニング
| 項目 | 仕様 |
|------|------|
| バージョン作成タイミング | ファイルアップロード時に自動作成 |
| 表示情報 | バージョン番号、編集者名、日時、変更概要 |
| 初版・最新の表示 | バッジで明示 |

#### 4.2 バージョン比較
| 項目 | 仕様 |
|------|------|
| 比較方法 | 2つのバージョンをチェックボックスで選択 |
| 差分表示 | 変更箇所をハイライト（追加:緑 / 削除:赤） |
| 差分モーダル | 変更前後を並べて表示 |

#### 4.3 Wordファイル編集連携
| 項目 | 仕様 |
|------|------|
| ダウンロード | 現在のバージョンをWordでダウンロード |
| アップロード | 編集済みWordをアップロードして新バージョン作成 |
| 差分確認 | アップロード時に変更内容をプレビュー |

### 5. 期日・タイムライン管理

#### 5.1 自動抽出される日付
| 日付タイプ | 説明 |
|-----------|------|
| 契約開始日 | 契約の効力発生日 |
| 契約満了日 | 契約の終了日 |
| 更新判断期限 | 自動更新を止めるための通知期限 |
| 請求書発行日 | 月次等の請求日 |
| 支払期日 | 報酬の支払い期限 |

#### 5.2 タイムライン表示
- 時系列でイベントを一覧表示
- 完了/今月/毎月/重要などのバッジ表示
- カウントダウン表示（更新判断期限まで「あとX日」）

#### 5.3 リマインド通知
| 項目 | 仕様 |
|------|------|
| 通知タイミング | 期限の1週間前、1日前（個人設定で変更可能） |
| 重要な交渉の場合 | 2週間前、1週間前、1日前（より早めに通知） |
| 通知方法 | メール、ブラウザ通知（将来：Slack/Teams連携） |

### 6. 通知設定

#### 6.1 設計思想
| 原則 | 説明 |
|------|------|
| ズボラな人向け | デフォルト設定のまま何もしなくても適切な通知が届く |
| こだわりたい人向け | 個別の交渉ごとに通知レベルを調整可能 |
| 通知疲れ防止 | 編集+コメントをまとめて1通にするなど、通知数を最小化 |

#### 6.2 個人設定（グローバル設定）
すべての交渉に適用されるデフォルト設定。1回設定すれば基本的に触る必要なし。

##### 通知チャネル
| チャネル | 説明 |
|----------|------|
| メール | 登録メールアドレスに送信（デフォルトON） |
| ブラウザ通知 | プッシュ通知（デフォルトON） |
| Slack | Slack連携時に選択可能 |

##### 期限リマインダー
| 設定項目 | デフォルト値 | 選択肢 |
|----------|-------------|--------|
| 1回目のリマインド | 1週間前 | 2週間前、1週間前、3日前、1日前 |
| 2回目のリマインド | 1日前 | 3日前、1日前、当日 |

##### 静穏時間
| 設定項目 | デフォルト値 |
|----------|-------------|
| 有効/無効 | 有効 |
| 時間帯 | 22:00〜08:00 |
| 備考 | 署名リクエストは静穏時間中も通知される |

#### 6.3 交渉ごとの通知設定
管理タブで設定。個人設定を上書きする形で、交渉の重要度に応じて調整可能。

##### 通知レベル（3段階）
| レベル | 説明 | 届く通知 |
|--------|------|----------|
| **標準**（デフォルト） | 相手が更新したら通知 | 契約書の編集・コメント（まとめて1通）、署名リクエスト、期限リマインダー |
| **最小限** | 署名と期限だけ通知 | 署名リクエスト、期限リマインダーのみ |
| **オフ** | 通知しない | アプリ内通知センターには記録される |

##### 重要な交渉マーク
| 項目 | 説明 |
|------|------|
| 効果 | リマインダーが通常より早め（2週間前、1週間前、1日前）に届く |
| 用途 | 大型案件、期限が厳しい交渉など、見落としたくない場合に使用 |

#### 6.4 通知のまとめロジック（バッチウィンドウ方式）

##### 背景・課題
編集とコメントは実際のユーザー行動ではセットになることが多い。
```
例：田中さんが契約書を編集 → 「第3条を修正しました」とコメント
```
これを2通の通知として送ると通知疲れを起こすため、まとめて1通にする。

##### ロジック
```
イベント発生
    ↓
5分間のバッチウィンドウを開始（すぐには通知しない）
    ↓
ウィンドウ内の同一人物のアクションをまとめる
    ↓
ウィンドウ終了 → 1通にまとめて通知送信
```

##### まとめるルール
| 条件 | まとめる？ |
|------|----------|
| 同じ人が5分以内に複数アクション | ✅ まとめる |
| 違う人のアクション | ❌ 別々に通知 |
| 5分以上空いたアクション | ❌ 別々に通知 |
| 署名リクエスト | ❌ 常に即時通知（重要なため例外） |

##### 通知メッセージの表示
| パターン | 通知タイトル | 通知本文 |
|----------|-------------|----------|
| 編集のみ | 「田中さんが契約書を更新しました」 | （なし） |
| 編集+コメント | 「田中さんが契約書を更新しました」 | 「第3条を修正しました！ご確認ください」← コメント内容 |
| 複数回編集+コメント | 「田中さんが契約書を更新しました（2箇所）」 | 「報酬と期間を調整しました」← 最新のコメント |

##### 実装イメージ（疑似コード）
```javascript
// イベント発生時
function onContractEvent(event) {
  // 署名リクエストは即時通知
  if (event.type === 'signature_request') {
    sendImmediately(event);
    return;
  }

  const key = `${event.negotiationId}_${event.userId}`;

  // 既存のウィンドウがあれば追加、なければ新規作成
  if (pendingNotifications[key]) {
    pendingNotifications[key].events.push(event);
  } else {
    pendingNotifications[key] = {
      events: [event],
      timer: setTimeout(() => sendBatchedNotification(key), 5 * 60 * 1000)
    };
  }
}

// 5分後にまとめて送信
function sendBatchedNotification(key) {
  const batch = pendingNotifications[key];
  const events = batch.events;

  // イベントをまとめて1通の通知を作成
  const editCount = events.filter(e => e.type === 'edit').length;
  const latestComment = events.filter(e => e.type === 'comment').pop();

  const notification = {
    title: editCount > 1
      ? `${events[0].userName}さんが契約書を更新しました（${editCount}箇所）`
      : `${events[0].userName}さんが契約書を更新しました`,
    body: latestComment?.content || null,
  };

  send(notification);
  delete pendingNotifications[key];
}
```

#### 6.5 通知の種類一覧
| 通知タイプ | トリガー | 標準 | 最小限 | オフ |
|-----------|---------|:----:|:------:|:---:|
| 契約書更新 | 相手が編集・コメント | ✅ | ❌ | ❌ |
| 署名リクエスト | 署名を求められた | ✅ | ✅ | ❌ |
| 期限リマインダー | 設定日前に自動送信 | ✅ | ✅ | ❌ |
| 合意完了 | 両者が合意し契約成立 | ✅ | ✅ | ❌ |
| 新規メンバー参加 | 交渉に新メンバー追加 | ✅ | ❌ | ❌ |

### 7. 招待・権限管理

#### 7.1 招待方法
| 方法 | 説明 |
|------|------|
| メールアドレス招待 | メールアドレスを入力して招待 |
| リンク共有 | 招待URLをコピーして共有 |

#### 7.2 権限タイプ
| 権限 | 説明 |
|------|------|
| 合意権限あり（Signer） | 契約への合意が可能、閲覧・編集・コメント可能 |
| メンバー（Member） | 閲覧・編集・コメントのみ、合意は不可 |

#### 7.3 メンバー管理
- 現在のメンバー一覧表示
- 権限タイプの確認
- メンバーの追加

### 8. 合意フロー

#### 8.1 合意プロセス
```
[自分が合意] → [相手方の合意待ち] → [両者合意で契約成立]
     ↓                 ↓                    ↓
「この内容で      ステータスバナーで    紙吹雪演出で
 合意」ボタン     待機状態を表示        成立を祝福
```

#### 8.2 ステータス管理
| ステータス | 説明 |
|-----------|------|
| 交渉中 | 契約内容を協議中 |
| 返答待ち | 相手からのレスポンス待ち |
| 相手方合意待ち | 自分は合意済み、相手の合意を待機 |
| 合意済み | 両者が合意し契約成立 |

#### 8.3 合意後のアクション
- 契約書のダウンロード
- 契約書の編集ロック

### 9. 一覧画面（ダッシュボード）

#### 9.1 表示項目
| 項目 | 説明 |
|------|------|
| 契約書名 | 契約書のタイトル |
| 相手先 | 取引相手の会社名・担当者名 |
| ステータス | 交渉中/返答待ち/合意済み |
| 最終更新 | 最後に更新された日時 |
| バージョン | 現在のバージョン番号 |
| 最新アクティビティ | 直近のコメント・変更内容 |

#### 9.2 機能
- 検索（契約書名、相手先で検索）
- フィルター（ステータス別、日付順）
- セクション分け（交渉中 / 合意済み）

---

## 📊 画面構成

### 画面一覧
| 画面名 | 説明 | ファイル |
|--------|------|---------|
| サービスサイト | LP（プロダクト紹介） | website.html |
| 交渉一覧 | ダッシュボード | index.html |
| 交渉詳細 | メイン交渉画面 | negotiation.html |
| 招待受領 | 招待リンクからのランディング | invite.html |
| 個人設定 | アカウント設定・通知設定 | settings.html |

### 交渉詳細画面のタブ構成

#### 概要タブ
- ステータスバナー（現在のバージョン情報）
- この契約の要点（AI生成）
- 人・モノ・金の流れ（AI生成）
- これからのタイムライン（AI生成）

#### 契約書タブ
- バージョン履歴パネル（左）
- 契約書本文（右）
- AI解説カード
- コメント表示

#### 管理タブ
- 重要な日付
- 金額サマリー
- 次のアクション
- アクティビティログ
- 関連ドキュメント
- **この交渉の通知設定**（標準/最小限/オフ、重要マーク）

#### 右サイドバー（共通）
- メッセージ（チャット）
- コメントスレッドパネル

---

## 🔐 非機能要件

### セキュリティ
| 項目 | 要件 |
|------|------|
| 認証 | OAuth 2.0（Google, Microsoft） |
| 通信 | HTTPS必須 |
| データ暗号化 | 保存データの暗号化 |
| アクセス制御 | 招待されたメンバーのみアクセス可能 |

### パフォーマンス
| 項目 | 目標値 |
|------|--------|
| ページロード | 3秒以内 |
| AI解説生成 | 5秒以内 |
| ファイルアップロード | 20MB/30秒以内 |

### 可用性
| 項目 | 目標値 |
|------|--------|
| 稼働率 | 99.9% |
| バックアップ | 日次バックアップ |
| DR | リージョン冗長（将来） |

### 対応環境
| 項目 | 対応範囲 |
|------|---------|
| ブラウザ | Chrome, Safari, Edge, Firefox（最新2バージョン） |
| デバイス | PC（レスポンシブ対応でタブレットも可） |
| モバイル | 将来対応（閲覧のみを優先） |

---

## 📈 成功指標（KPI）

### プロダクトKPI
| 指標 | 目標 | 測定方法 |
|------|------|---------|
| 契約締結までの時間 | 70%短縮 | 初回アップロードから合意までの日数 |
| 法務問い合わせ数 | 85%削減 | AI解説利用後の問い合わせ発生率 |
| ユーザー満足度 | 95%以上が「わかりやすい」 | NPS調査 |

### 事業KPI
| 指標 | 目標 |
|------|------|
| MAU | 月間アクティブユーザー数 |
| 有料転換率 | フリートライアルからの転換率 |
| チャーンレート | 月次解約率 |

---

## 🚀 リリース計画

### Phase 1: MVP（最小実行可能プロダクト）
**目標：契約交渉の基本フローを実現**
- [ ] 契約書アップロード（Word対応）
- [ ] AI要点サマリー生成
- [ ] メッセージ（チャット）機能
- [ ] バージョン管理（基本）
- [ ] 招待機能
- [ ] 合意フロー

### Phase 2: コア機能強化
**目標：交渉体験の向上**
- [ ] コメントスレッド機能
- [ ] AI解説機能（テキスト選択）
- [ ] バージョン比較・差分表示
- [ ] タイムライン・期日管理
- [ ] リマインド通知

### Phase 3: エンタープライズ対応
**目標：法人利用の拡大**
- [ ] チーム・組織管理
- [ ] 監査ログ
- [ ] SSO対応
- [ ] API提供
- [ ] Slack/Teams連携

### Phase 4: 高度なAI機能
**目標：AIによる契約交渉支援の深化**
- [ ] AIによる修正提案
- [ ] リスク自動検出
- [ ] 契約テンプレート提案
- [ ] 過去契約との比較分析

---

## 📝 用語集

| 用語 | 定義 |
|------|------|
| 交渉 | 契約書に対する協議・調整の単位 |
| バージョン | 契約書の版数。アップロードごとに自動インクリメント |
| 合意 | 契約内容に同意すること。両者の合意で契約成立 |
| メンバー | 交渉に参加している人（自分＋招待した相手） |
| 合意権限 | 「この内容で合意」を押す権限 |

---

## 📎 参考資料

- デモサイト: `website.html`（サービスサイト）
- デモアプリ: `index.html`, `negotiation.html`, `invite.html`, `settings.html`

---

**Document Version:** 1.1
**Last Updated:** 2026-02-03
**Author:** HubbleNego Product Team
