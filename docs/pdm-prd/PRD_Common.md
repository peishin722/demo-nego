# HubbleNego 共通仕様書

> このドキュメントは、Nego単体利用・Hubble連携利用の両方に共通する仕様を定義します。
> - Nego単体利用の詳細 → [PRD_Nego_Standalone.md](./PRD_Nego_Standalone.md)
> - Hubble連携利用の詳細 → [PRD_Nego_Hubble.md](./PRD_Nego_Hubble.md)

---

## 1. プロダクト概要

### 1.1 プロダクトビジョン
> **「契約がわかると、信頼される。」**

AIが契約書を「あなたの言葉」に翻訳し、理解して交渉し、守れる約束を結ぶ。それが次のビジネスを生む。

### 1.2 解決する課題

| 課題 | 現状 | HubbleNegoによる解決 |
|------|------|----------------------|
| 契約書が難しい | 法律用語が理解できず、何を約束しているのかわからない | AIが平易な日本語に翻訳、要点を3行でサマリー |
| 交渉に時間がかかる | メールの往復で認識のズレが発生、締結まで長期化 | 同じ画面でリアルタイム交渉、コメント・チャットで即解決 |
| 版管理が混乱 | 「最新版どれ？」問題、変更履歴が追えない | 自動バージョン管理、差分比較機能 |

### 1.3 ターゲットユーザー

#### プライマリペルソナ
**「契約書を扱う必要があるが、法務の専門家ではないビジネスパーソン」**

- 営業マネージャー（取引先との契約交渉）
- 事業開発担当者（パートナーシップ契約）
- スタートアップ経営者（各種契約を自分で対応）
- フリーランス・個人事業主（業務委託契約）
- 財務担当者（投資契約など重要な契約の交渉・締結）

#### セカンダリペルソナ
- 法務担当者（複数の契約を効率的に管理）

---

## 2. AI機能

### 2.1 契約書サマリー（自動生成）

| 機能 | 説明 |
|------|------|
| 要点サマリー | 契約の要点を3行で自動生成 |
| 人・モノ・金の流れ | 当事者間の取引構造を図示 |
| タイムライン | 重要日付（開始・満了・更新判断期限・請求日等）を自動抽出 |
| ハイライト | 金額・期間・責任範囲を自動でマーク |

### 2.2 AI解説機能

| 機能 | 説明 |
|------|------|
| テキスト選択解説 | 選択した条文を平易な日本語で解説 |
| 注意点の提示 | リスクや注意すべきポイントをアラート表示 |
| 質問応答 | 契約内容についてAIに質問可能（将来機能） |

### 2.3 AI生成物の表示ルール
- 全てのAI生成コンテンツに「AI生成」バッジを表示
- 「契約書から自動生成されています。内容をご確認ください。」の注記

---

## 3. リアルタイム交渉機能

### 3.1 メッセージ（チャット）

| 項目 | 仕様 |
|------|------|
| リアルタイム送受信 | 対応 |
| 送信者表示 | アバター（イニシャル）＋名前＋タイムスタンプ |
| 既読機能 | 将来対応 |
| 通知 | メール通知（新着メッセージ時） |

### 3.2 コメントスレッド

| 項目 | 仕様 |
|------|------|
| 対象 | 契約書内の任意のテキストに紐付け |
| スレッド形式 | 1コメントに対して複数の返信が可能 |
| 表示 | 契約書本文にコメントアイコン＋件数を表示 |
| アクセス | アイコンクリックでスレッドパネル表示 |

---

## 4. バージョン管理

### 4.1 自動バージョニング

| 項目 | 仕様 |
|------|------|
| バージョン作成タイミング | ファイルアップロード時に自動作成 |
| 表示情報 | バージョン番号、編集者名、日時、変更概要 |
| 初版・最新の表示 | バッジで明示 |

### 4.2 当事者バッジ

バージョン履歴の各アイテムには、どちらの当事者がアップロードしたかを示すバッジを表示する。

| バッジ | スタイル | 説明 |
|--------|---------|------|
| 自社 | 青系（`internal`） | 自分側がアップロードしたバージョン |
| 先方 | オレンジ系（`external`） | 交渉相手がアップロードしたバージョン |

- バッジはバージョン番号・編集者名・日時と同じ行に表示
- どちらの修正版かが一目でわかることで、交渉の流れを把握しやすくする

### 4.3 バージョン比較

| 項目 | 仕様 |
|------|------|
| 比較方法 | 2つのバージョンをチェックボックスで選択 |
| 差分表示 | 変更箇所をハイライト（追加:緑 / 削除:赤） |
| 差分モーダル | 変更前後を並べて表示 |

### 4.4 Wordファイル編集連携

| 項目 | 仕様 |
|------|------|
| ダウンロード | 現在のバージョンをWordでダウンロード |
| アップロード | 編集済みWordをアップロードして新バージョン作成 |
| 差分確認 | アップロード時に変更内容をプレビュー |

---

## 5. 署名・締結フロー

### 5.1 全体フロー

```
[交渉完了] → [署名手続き・設定] → [署名依頼送信] → [全員署名完了] → [契約締結]
                  │                     │                 │              │
                  ↓                     ↓                 ↓              ↓
           書類選択・            各署名者に          ステータス      紙吹雪演出で
           署名者設定・          署名画面を送信      バナーで進捗    締結を祝福
           署名位置配置                              を表示

```

### 5.2 署名手続き・設定ウィザード（3ステップ）

交渉画面のヘッダーにある「署名手続き・設定」ボタンから起動する。

#### Step 1: 書類の選択

署名対象の書類を選択する。契約書タブに登録されている書類が一覧表示される。

| 項目 | 仕様 |
|------|------|
| 書類タイプ: 契約書 | デフォルトで **チェックON** |
| 書類タイプ: 添付書類 | デフォルトで **チェックOFF** |
| AI要約表示 | 選択中の契約書のAI要約を右側に表示 |
| 複数書類対応 | 複数の契約書・添付書類をパッケージとして署名可能 |

#### Step 2: 署名者の設定

署名に参加する当事者を設定する。

| 項目 | 仕様 |
|------|------|
| 署名者の識別 | 名前・会社名・色分けで識別（ラベルは使用しない） |
| 署名者タイプ | 「自分で署名」または「相手に送信」 |
| 署名者の追加 | 3者以上のマルチサイナーに対応 |
| 署名方法の選択 | 署名者ごとにテキスト署名 or 印影を選択 |
| メールアドレス | 「相手に送信」の場合に入力 |
| 転送許可 | 受信者が別の署名者に転送できるオプション（デフォルト: ON） |
| 署名順序 | 順次署名（リレー方式）または 一括送信（並行方式）を選択 |

#### Step 3: 署名位置の配置と実行

| 項目 | 仕様 |
|------|------|
| 署名位置の配置 | 契約書プレビュー上にドラッグ&ドロップで署名位置を指定 |
| 配置の必須/任意 | **任意**（配置しなくても署名手続きを実行可能） |
| 署名者ごとの色分け | 各署名者に割り当てられた色でスタンプ位置を表示 |
| 書類ごとの配置 | 複数書類がある場合、書類タブを切り替えて各書類に配置 |
| 自分の署名 | 「自分で署名」の署名者は、ここで署名入力＋同意チェック |
| 実行ボタン | 全ての必須項目（自分の署名入力＋同意チェック）完了後に活性化 |

### 5.3 署名方法

| 方法 | 説明 |
|------|------|
| テキスト署名 | 名前をテキスト入力し、署名スタイルでプレビュー表示 |
| 印影（デジタル印鑑） | 姓を入力し、丸い印影スタイルでプレビュー表示 |

### 5.4 署名画面（sign.html）

署名依頼を受けた相手に表示される独立した署名専用画面。

| 項目 | 仕様 |
|------|------|
| 契約書プレビュー | A4サイズのプレビュー表示、全文展開可能 |
| AI要約 | 契約の要点サマリーを表示 |
| 署名入力 | 指定された方法（テキスト or 印影）で署名 |
| 同意チェック | 「内容を確認し、同意します」チェックボックス |
| 完了演出 | 署名完了時に紙吹雪演出 |
| 転送機能 | 転送許可されている場合、別の署名者への転送が可能 |

### 5.5 ステータス管理

| ステータス | 説明 | バナー表示 |
|-----------|------|-----------|
| 交渉中（negotiating） | 契約内容を協議中 | バナーなし |
| 署名依頼送信済み（signing_setup_done） | 署名手続きが完了し、署名依頼を送信した状態 | 「署名依頼を送信しました」バナー |
| 署名者ビュー（signer_view） | 署名依頼を受けた側のビュー | 「署名してください」バナー |
| 自分署名済み（my_signer_signed） | 自分は署名完了、相手の署名待ち | 「相手方の署名をお待ちください」バナー |
| 締結済み（concluded） | 全員の署名が完了し契約締結 | 「契約が締結されました」バナー |

### 5.6 締結済みビューア

全員の署名が完了した後に表示される専用画面。

| 項目 | 仕様 |
|------|------|
| 表示形式 | フルスクリーンビューア |
| 書類タブ | 複数書類がある場合、タブで切り替え表示 |
| 署名記録 | 全署名者の署名内容・タイムスタンプを一覧表示 |
| AI要約 | 契約の要点サマリーを再表示 |
| 署名証明書 | 証明書リンクを表示 |
| ダウンロード | 個別PDF / 一括PDFダウンロード |
| 編集ロック | 締結後は契約書の編集不可 |

### 5.7 締結後のアクション
- 契約書のPDFダウンロード（個別 / 一括）
- 署名証明書の確認
- 契約書の編集ロック

---

## 6. 期日・タイムライン管理

### 6.1 自動抽出される日付

| 日付タイプ | 説明 |
|-----------|------|
| 契約開始日 | 契約の効力発生日 |
| 契約満了日 | 契約の終了日 |
| 更新判断期限 | 自動更新を止めるための通知期限 |
| 請求書発行日 | 月次等の請求日 |
| 支払期日 | 報酬の支払い期限 |

### 6.2 タイムライン表示
- 時系列でイベントを一覧表示
- 完了/今月/毎月/重要などのバッジ表示
- カウントダウン表示（更新判断期限まで「あとX日」）

---

## 7. 通知設計

### 7.1 設計思想

| 原則 | 説明 |
|------|------|
| ズボラな人向け | デフォルト設定のまま何もしなくても適切な通知が届く |
| 通知疲れ防止 | 同一人物の連続アクションをまとめて1通にするなど、通知数を最小化 |
| 受け手の状態に合わせる | 未登録ユーザー・登録ユーザー・Hubble連携ユーザーで通知内容と導線を最適化 |

### 7.2 ユーザータイプ別の通知対象

通知の受け手は3タイプ存在する。それぞれ受け取る通知の範囲と導線が異なる。

#### タイプA: Negoユーザー（Hubble未連携）

Negoに登録済みのユーザー。交渉の主体として全ての通知を受け取る。

#### タイプB: 未サインアップの招待ユーザー

Negoユーザーに招待されたが、まだサインアップしていないユーザー。メール通知のみ受け取り、通知の導線はすべて招待受領画面（invite.html）やサインアップへ誘導する。

#### タイプC: Hubble連携ユーザー

HubbleとNegoを連携しているユーザー。基本的にはタイプAと同じ通知を受け取るが、Hubble側の通知（社内コメント等）と重複しないよう調整する。

---

### 7.3 通知イベント一覧

交渉のライフサイクルに沿って、全通知イベントを定義する。

#### 交渉フェーズの通知

| イベント | トリガー | タイプA | タイプB | タイプC | 優先度 | 配信タイミング |
|---------|---------|:------:|:------:|:------:|-------|------------|
| 交渉への招待 | メンバーが招待された時 | ✅ | ✅ | ✅ | 高 | 即時 |
| 新しいメッセージ | チャットで相手がメッセージ送信 | ✅ | — | ✅ | 中 | バッチ |
| 新しいコメント | 契約書テキストにコメント追加 | ✅ | — | ✅※ | 中 | バッチ |
| 契約書の更新 | 相手が新バージョンをアップロード | ✅ | — | ✅ | 中 | バッチ |

> ※ タイプCの「新しいコメント」：Nego上の交渉コメントのみ通知。Hubble側の社内コメントはHubbleの通知で管理。

#### 署名フェーズの通知

| イベント | トリガー | タイプA | タイプB | タイプC | 優先度 | 配信タイミング |
|---------|---------|:------:|:------:|:------:|-------|------------|
| 署名依頼 | 署名手続き完了後、署名者に送信 | ✅ | ✅ | ✅ | 最高 | 即時 |
| 署名リマインド | 署名依頼後、未署名の署名者へ | ✅ | ✅ | ✅ | 高 | 3日後・7日後 |
| 相手が署名完了 | 署名者の一人が署名を完了した時 | ✅ | — | ✅ | 高 | 即時 |
| 全員署名完了（締結） | 全署名者の署名が完了し契約締結 | ✅ | ✅ | ✅ | 最高 | 即時 |

---

### 7.4 タイプB（未サインアップユーザー）の通知設計

まだNegoに登録していないユーザーへの通知は、行動を促す重要な接点となる。

| 通知 | メール内容 | CTA（導線） |
|------|----------|-----------|
| 交渉への招待 | 「○○さんがあなたを契約交渉に招待しています」＋契約書名＋AI要約の抜粋 | 「契約書を確認する →」→ invite.html |
| 署名依頼 | 「○○さんから署名の依頼が届いています」＋契約書名＋期限 | 「署名する →」→ sign.html |
| 署名リマインド | 「署名がまだ完了していません」＋残り期間 | 「署名する →」→ sign.html |
| 全員署名完了（締結） | 「契約が締結されました」＋契約書名 | 「契約書をダウンロード →」→ サインアップへ誘導 |

> **設計意図**: 未登録ユーザーに対しては、通知自体がプロダクトとの最初のタッチポイントになる。メールの時点で「何の契約か」がわかるようにAI要約を含め、安心してアクションできるようにする。

---

### 7.5 タイプC（Hubble連携ユーザー）の通知差分

基本的にタイプAと同じ通知を受け取るが、以下の点で調整する。

| 項目 | 調整内容 |
|------|---------|
| コメント通知 | Nego上の交渉コメントのみ通知。Hubble側の社内コメント通知とは分離 |
| 契約書更新通知 | Negoから相手が更新した場合のみ通知。自社がHubbleから再共有した場合は通知しない（自分のアクションのため） |

---

### 7.6 通知のまとめロジック（バッチウィンドウ方式）

通知疲れを防ぐため、一定条件で通知をまとめる。

| 条件 | まとめる？ | 理由 |
|------|----------|------|
| 同じ人が5分以内に複数アクション | ✅ まとめる | メッセージ連投＋編集などの一連の作業を1通に |
| 違う人のアクション | ❌ 別々に通知 | 誰がアクションしたか明確にするため |
| 署名依頼・署名完了・締結 | ❌ 常に即時通知 | 重要なマイルストーンは例外として即時配信 |

---

### 7.7 通知チャネル

| チャネル | 対応状況 | 備考 |
|---------|---------|------|
| メール | 対応 | 全ての通知の基本チャネル |
| ブラウザ通知 | 将来対応 | ログイン中のリアルタイム通知 |
| Slack / Teams連携 | 将来対応 | チーム利用時の通知先として |

---

### 7.8 個人設定（グローバル設定 / settings.html）

ユーザーが通知の受信を制御するための設定。デフォルトで最適な状態にし、変更は任意。

| カテゴリ | 説明 | デフォルト |
|----------|------|-----------|
| 相手からのアクション | 契約書の更新、コメント、メッセージなど、相手方からのアクションがあった時に通知。同一人物の連続アクションは1通にまとめてお届け | 受け取る |
| 署名関連の通知 | 署名依頼、署名完了、契約締結の通知。**常に即時配信・OFFにできない** | 常に受け取る |

> 署名関連の通知は契約の成立に直結するため、ユーザーがOFFにすることはできない。

---

## 8. 招待・権限管理

### 8.1 招待方法

| 方法 | 説明 |
|------|------|
| メールアドレス招待 | メールアドレスを入力して招待 |
| リンク共有 | 招待URLをコピーして共有 |

### 8.2 権限タイプ

| 権限 | 説明 |
|------|------|
| メンバー（Member） | 閲覧・編集・コメントが可能 |

> 署名者は交渉への招待とは別に、署名手続き・設定（セクション5.2）で個別に設定する。Negoに招待する時点では権限タイプは1種類（メンバー）のみ。

### 8.3 招待受領画面（invite.html）

招待リンクを開いた時に表示される画面。サインイン前でも契約の概要を確認できる。

| 項目 | 仕様 |
|------|------|
| 送信者情報 | 招待者のアバター・名前・会社名を表示 |
| AI要約 | 契約の要点サマリーをサインイン前に表示 |
| 契約書プレビュー | 契約書全文をスクロールで閲覧可能 |
| サインイン方法 | Google / Microsoft のSSO |
| メリット一覧 | サインイン後にできることを一覧表示 |

---

## 9. 交渉詳細画面の共通仕様

Nego単体利用・Hubble連携利用のどちらでも共通する交渉詳細画面（negotiation.html）の仕様。

### 9.1 画面構成

```
┌─────────────────────────────────────────────────────────────────┐
│ ← 一覧に戻る    業務委託契約書    [メンバー] [署名手続き・設定] │
├─────────────────────────────────────────────────────────────────┤
│ [概要] [契約書] [関連書類]                                       │
├─────────┬───────────────────────────────────────────┬───────────┤
│ バージョン │                                           │ メッセージ│
│ 履歴      │         契約書本文エリア                  │           │
│           │                                           │ チャット  │
│ Ver.3 ◉  │                                           │           │
│ Ver.2    │                                           │ コメント  │
│ Ver.1    │                                           │ スレッド  │
│           │                                           │           │
├───────────┤                                           ├───────────┤
│ [Word編集]│                                           │ [送信]    │
└───────────┴───────────────────────────────────────────┴───────────┘
```

### 9.2 タブ構成

#### 概要タブ
- ステータスバナー（現在のバージョン情報）
- この契約の要点（AI生成 3行サマリー）
- 人・モノ・金の流れ図（AI生成 当事者間のフロー図を視覚化）
- これからのタイムライン（AI生成 支払日・更新期限等を時系列表示）

#### 契約書タブ
- バージョン履歴パネル（左サイドバー）
- 契約書本文（中央パネル）
- テキスト選択時のポップアップ（AI解説 / コメント追加）
- AI解説カード
- コメントアイコン表示

#### 関連書類タブ
- この交渉に関連する添付書類の一覧（見積書、発注書、請求書等）
- ファイルタイプアイコン付き表示
- 「+ 追加」ボタンで書類を追加可能

#### 右サイドバー（全タブ共通）
- メッセージ（チャット）
- コメントスレッドパネル

---

## 10. 非機能要件

### セキュリティ

| 項目 | 要件 |
|------|------|
| 認証 | OAuth 2.0（Google, Microsoft） |
| 通信 | HTTPS必須 |
| データ暗号化 | 保存データの暗号化 |
| アクセス制御 | 招待されたメンバーのみアクセス可能 |

### パフォーマンス

| 項目 | 目標値 |
|------|--------|
| ページロード | 3秒以内 |
| AI解説生成 | 5秒以内 |
| ファイルアップロード | 20MB/30秒以内 |

### 可用性

| 項目 | 目標値 |
|------|--------|
| 稼働率 | 99.9% |
| バックアップ | 日次バックアップ |

### 対応環境

| 項目 | 対応範囲 |
|------|---------|
| ブラウザ | Chrome, Safari, Edge, Firefox（最新2バージョン） |
| デバイス | PC（レスポンシブ対応でタブレットも可） |

---

## 11. 用語集

| 用語 | 定義 |
|------|------|
| 交渉 | 契約書に対する協議・調整の単位 |
| バージョン | 契約書の版数。アップロードごとに自動インクリメント |
| 署名 | 契約内容に同意し、署名を行うこと |
| 締結 | 全署名者の署名が完了し、契約が成立すること |
| メンバー | 交渉に参加している人（自分＋招待した相手） |
| 署名者（Signer） | 署名権限を持つメンバー。署名手続きに参加できる |
| 署名パッケージ | 複数の書類（契約書＋添付書類）をまとめた署名単位 |

---

**Document Version:** 2.0
**Last Updated:** 2026-02-09
