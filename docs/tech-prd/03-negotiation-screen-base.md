# Tech PRD: 交渉画面 - 基本表示 (Negotiation Screen Base)

> **【どんな画面？】**
> 契約書の中身を見て交渉を進めるための**メイン画面**です。
> 中央に契約書が表示され、周囲のタブやサイドバーから「チャット」「AI解説」「履歴」などの各機能にアクセスします。

## 1. 画面設計 (Visual Design Spec)

### UI構成要素
- **交渉ヘッダー**:
  - `[戻るボタン]`: ダッシュボードに戻る。
  - `[契約書タイトル]`: 編集可能なタイトル。
  - `[ステータスバナー]`: 現在のステータスを表示（例: "交渉中 - あなたのターンです"）。
  - `[アクションボタン]`: "合意する"、"招待" など。
- **タブナビゲーション**:
  - `[概要タブ]`: AIサマリーとタイムライン。
  - `[契約書タブ]`: メインのドキュメントビューア。
  - `[管理タブ]`: メタ情報、履歴、設定。
- **ドキュメントビューア (契約書タブ)**:
  - `[ドキュメントキャンバス]`: PDFまたはWordコンテンツを描画。
  - `[ページ操作]`: 拡大/縮小、ページ移動。
- **右サイドバー**:
  - `[サイドバー開閉]`: サイドバーの折りたたみ/展開。
  - `[チャットパネル]`: 交渉全体に対するチャット。
  - `[スレッドパネル]`: 文脈特定のコメント（コメント選択時に切り替わり）。

### 状態定義 (States)
- **読み込み中 (Loading)**: ドキュメント取得中のスピナー表示。
- **表示中 (Viewing)**: ドキュメントが正常に描画された状態。
- **エラー (Error)**: "文書を読み込めませんでした" と再試行ボタンを表示。

### ユーザーフロー (Mermaid)
```mermaid
graph TD
    A[交渉画面に入る] --> B[ドキュメントとメタデータを読み込み]
    B --> C[契約書タブを表示 (デフォルト)]
    C --> D[ユーザーがタブをクリック]
    D -- 概要 --> E[AIサマリーを表示]
    D -- 管理 --> F[管理情報を表示]
    C --> G[ユーザーがドキュメントをスクロール]
    G --> H[現在ページ表示を更新]
```

## 2. 振る舞い仕様 (BDD)

```gherkin
Feature: 交渉画面の表示とナビゲーション

  Scenario: 契約書画面の初期表示
    Given ユーザーはダッシュボードから契約書を選択した
    When 交渉詳細画面に遷移する
    Then "契約書タブ" がデフォルトで選択されている
    And 中央に契約書本文が表示される
    And 右側にチャットパネルが表示される
    And ヘッダーに現在のステータスが表示される

  Scenario: タブ切り替え
    Given ユーザーは "契約書タブ" を見ている
    When "概要タブ" をクリックする
    Then 契約書ビューアが非表示になる
    And AI要点サマリーとタイムラインが表示される

  Scenario: 文書の読み込みエラー
    Given ネットワークエラーが発生している
    When 交渉詳細画面に遷移する
    Then "文書を読み込めませんでした" というエラーメッセージが表示される
    And "再読み込み" ボタンが表示される
```

## 3. 非機能要件・受入基準
- **レンダリング**: PDF/Wordのレンダリングは崩れがないこと。
- **スクロール**: 長い契約書でもスムーズにスクロールできること（仮想スクロール等の検討）。
