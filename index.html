<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>契約交渉プラットフォーム</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ヘッダー -->
    <div class="header">
        <div class="header-left">
            <div class="contract-title">業務委託基本契約書</div>
            <span class="partner-badge">株式会社XYZ 田中様</span>
        </div>
        <div class="header-actions">
            <button class="header-btn primary agree-btn" id="agreeBtn" onclick="agreeContract()">
                ✅ この内容で合意
            </button>
        </div>
    </div>

    <!-- メインコンテナ(2カラム) -->
    <div class="main-wrapper">
        <!-- 左カラム -->
        <div class="left-column">
            <!-- メインタブ -->
            <div class="main-tabs">
                <button class="main-tab active" onclick="switchMainTab('overview')">
                    <span>📊</span>
                    <span>概要</span>
                </button>
                <button class="main-tab" onclick="switchMainTab('contract')">
                    <span>📄</span>
                    <span>契約書</span>
                </button>
                <button class="main-tab" onclick="switchMainTab('management')">
                    <span>📅</span>
                    <span>管理</span>
                </button>
            </div>

            <!-- 概要タブ -->
            <div class="tab-content active" id="overview">
                <div class="overview-container">
                    <!-- この契約の要点カード -->
                    <div class="summary-card key-points-card">
                        <div class="card-header">
                            <div class="card-icon">🎯</div>
                            <div class="card-title">この契約の要点</div>
                        </div>
                        <div class="key-points-content">
                            <ul class="key-points-list">
                                <li>ABC社がXYZ社にマーケティング支援を提供する契約です</li>
                                <li>期間は6ヶ月間、月額48万円の報酬</li>
                                <li>問題なければ自動更新される形式</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 人・モノ・金の流れ図 -->
                    <div class="summary-card">
                        <div class="card-header">
                            <div class="card-icon">📈</div>
                            <div class="card-title">人・モノ・金の流れ</div>
                        </div>
                        <div class="flow-section">
                            <div class="flow-diagram">
                                <div class="flow-node">
                                    <div class="flow-box">ABC社<br><span class="flow-sub">(あなたの会社)</span></div>
                                </div>
                                <div class="flow-arrow-container">
                                    <div class="flow-arrow-line"></div>
                                    <div class="flow-arrow-label">サービス提供</div>
                                    <div class="flow-arrow-head">→</div>
                                </div>
                                <div class="flow-node">
                                    <div class="flow-box partner">XYZ社<br><span class="flow-sub">(田中様)</span></div>
                                </div>
                            </div>
                            <div class="flow-diagram">
                                <div class="flow-node">
                                    <div class="flow-box partner">XYZ社<br><span class="flow-sub">(田中様)</span></div>
                                </div>
                                <div class="flow-arrow-container">
                                    <div class="flow-arrow-line reverse"></div>
                                    <div class="flow-arrow-label money">月48万円</div>
                                    <div class="flow-arrow-head">→</div>
                                </div>
                                <div class="flow-node">
                                    <div class="flow-box">ABC社<br><span class="flow-sub">(あなたの会社)</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- タイムラインカード -->
                    <div class="summary-card">
                        <div class="card-header">
                            <div class="card-icon">📅</div>
                            <div class="card-title">これからのタイムライン</div>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item success">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">2026年2月1日</div>
                                    <div class="timeline-title">契約開始</div>
                                </div>
                            </div>
                            <div class="timeline-item warning">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">2026年5月31日</div>
                                    <div class="timeline-title">⚠️ 契約更新判断期限</div>
                                    <div class="timeline-alert">この日までに連絡しないと自動更新</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">2026年7月31日</div>
                                    <div class="timeline-title">契約満了</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 契約書タブ -->
            <div class="tab-content" id="contract">
                <div class="contract-container">
                    <!-- ステータスバー -->
                    <div class="contract-status-bar">
                        <div class="status-left">
                            <span class="status-badge" id="contractStatusBadge">💬 交渉中</span>
                        </div>
                        <div class="status-right">
                            <button class="status-action-btn" id="editLockBtn" onclick="toggleEditLock()">
                                📝 Wordで編集
                            </button>
                            <button class="status-action-btn" onclick="openUploadModal()">📤 アップロード</button>
                            <button class="status-action-btn" onclick="downloadWord()">📥 ダウンロード</button>
                        </div>
                    </div>

                    <!-- 契約書サブタブ -->
                    <div class="contract-subtabs">
                        <button class="contract-subtab active" onclick="switchContractSubtab('basic')">
                            📄 基本契約書
                        </button>
                        <button class="contract-subtab" onclick="switchContractSubtab('individual-a')">
                            📋 個別契約(案件A)
                        </button>
                        <button class="add-contract-subtab" onclick="addNewContract()">
                            + 新規追加
                        </button>
                    </div>

                    <!-- 契約書コンテンツ -->
                    <div class="contract-content-area">
                        <!-- 左側: バージョンツリー -->
                        <div class="version-tree-panel">
                            <div class="version-tree-header">
                                <span class="version-tree-title">📋 バージョン履歴</span>
                                <label class="version-compare-toggle">
                                    <input type="checkbox" id="compareMode" onchange="toggleCompareMode()">
                                    <span>比較</span>
                                </label>
                            </div>
                            <div class="version-tree-list">
                                <!-- Ver 8 (現在) -->
                                <div class="version-item current" data-version="8">
                                    <div class="version-node">
                                        <div class="version-line"></div>
                                        <div class="version-dot"></div>
                                    </div>
                                    <div class="version-info">
                                        <div class="version-header">
                                            <span class="version-number">Ver. 8</span>
                                            <span class="version-badge current">最新</span>
                                        </div>
                                        <div class="version-meta">
                                            <span class="version-editor">田中太郎</span>
                                            <span class="version-date">01/28 14:15</span>
                                        </div>
                                        <div class="version-changes">契約期間を6ヶ月に変更</div>
                                    </div>
                                    <div class="version-actions">
                                        <input type="checkbox" class="compare-checkbox" data-version="8">
                                    </div>
                                </div>
                                <!-- Ver 7 -->
                                <div class="version-item" data-version="7">
                                    <div class="version-node">
                                        <div class="version-line"></div>
                                        <div class="version-dot"></div>
                                    </div>
                                    <div class="version-info">
                                        <div class="version-header">
                                            <span class="version-number">Ver. 7</span>
                                        </div>
                                        <div class="version-meta">
                                            <span class="version-editor">佐藤一郎</span>
                                            <span class="version-date">01/28 11:35</span>
                                        </div>
                                        <div class="version-changes">報酬を48万円に修正</div>
                                    </div>
                                    <div class="version-actions">
                                        <input type="checkbox" class="compare-checkbox" data-version="7">
                                    </div>
                                </div>
                                <!-- Ver 6 -->
                                <div class="version-item" data-version="6">
                                    <div class="version-node">
                                        <div class="version-line"></div>
                                        <div class="version-dot"></div>
                                    </div>
                                    <div class="version-info">
                                        <div class="version-header">
                                            <span class="version-number">Ver. 6</span>
                                        </div>
                                        <div class="version-meta">
                                            <span class="version-editor">田中太郎</span>
                                            <span class="version-date">01/28 10:20</span>
                                        </div>
                                        <div class="version-changes">初回ドラフト送付</div>
                                    </div>
                                    <div class="version-actions">
                                        <input type="checkbox" class="compare-checkbox" data-version="6">
                                    </div>
                                </div>
                                <!-- Ver 5 -->
                                <div class="version-item" data-version="5">
                                    <div class="version-node">
                                        <div class="version-line"></div>
                                        <div class="version-dot"></div>
                                    </div>
                                    <div class="version-info">
                                        <div class="version-header">
                                            <span class="version-number">Ver. 5</span>
                                        </div>
                                        <div class="version-meta">
                                            <span class="version-editor">佐藤一郎</span>
                                            <span class="version-date">01/27 16:40</span>
                                        </div>
                                        <div class="version-changes">秘密保持条項を追加</div>
                                    </div>
                                    <div class="version-actions">
                                        <input type="checkbox" class="compare-checkbox" data-version="5">
                                    </div>
                                </div>
                                <!-- Ver 4 -->
                                <div class="version-item" data-version="4">
                                    <div class="version-node">
                                        <div class="version-line"></div>
                                        <div class="version-dot"></div>
                                    </div>
                                    <div class="version-info">
                                        <div class="version-header">
                                            <span class="version-number">Ver. 4</span>
                                        </div>
                                        <div class="version-meta">
                                            <span class="version-editor">田中太郎</span>
                                            <span class="version-date">01/27 14:20</span>
                                        </div>
                                        <div class="version-changes">業務内容を詳細化</div>
                                    </div>
                                    <div class="version-actions">
                                        <input type="checkbox" class="compare-checkbox" data-version="4">
                                    </div>
                                </div>
                                <!-- Ver 3 -->
                                <div class="version-item" data-version="3">
                                    <div class="version-node">
                                        <div class="version-line"></div>
                                        <div class="version-dot"></div>
                                    </div>
                                    <div class="version-info">
                                        <div class="version-header">
                                            <span class="version-number">Ver. 3</span>
                                        </div>
                                        <div class="version-meta">
                                            <span class="version-editor">佐藤一郎</span>
                                            <span class="version-date">01/26 11:00</span>
                                        </div>
                                        <div class="version-changes">報酬条項を修正</div>
                                    </div>
                                    <div class="version-actions">
                                        <input type="checkbox" class="compare-checkbox" data-version="3">
                                    </div>
                                </div>
                                <!-- Ver 2 -->
                                <div class="version-item" data-version="2">
                                    <div class="version-node">
                                        <div class="version-line"></div>
                                        <div class="version-dot"></div>
                                    </div>
                                    <div class="version-info">
                                        <div class="version-header">
                                            <span class="version-number">Ver. 2</span>
                                        </div>
                                        <div class="version-meta">
                                            <span class="version-editor">田中太郎</span>
                                            <span class="version-date">01/25 15:30</span>
                                        </div>
                                        <div class="version-changes">契約期間を1年に設定</div>
                                    </div>
                                    <div class="version-actions">
                                        <input type="checkbox" class="compare-checkbox" data-version="2">
                                    </div>
                                </div>
                                <!-- Ver 1 (初版) -->
                                <div class="version-item" data-version="1">
                                    <div class="version-node first">
                                        <div class="version-line"></div>
                                        <div class="version-dot"></div>
                                    </div>
                                    <div class="version-info">
                                        <div class="version-header">
                                            <span class="version-number">Ver. 1</span>
                                            <span class="version-badge initial">初版</span>
                                        </div>
                                        <div class="version-meta">
                                            <span class="version-editor">佐藤一郎</span>
                                            <span class="version-date">01/24 10:00</span>
                                        </div>
                                        <div class="version-changes">契約書作成</div>
                                    </div>
                                    <div class="version-actions">
                                        <input type="checkbox" class="compare-checkbox" data-version="1">
                                    </div>
                                </div>
                            </div>
                            <div class="version-tree-footer">
                                <button class="compare-btn" id="compareBtn" disabled>
                                    🔍 バージョン比較
                                </button>
                            </div>
                        </div>

                        <!-- 右側: 契約書本文 -->
                        <div class="contract-content-inner">
                            <!-- AI解説カード -->
                            <div class="ai-explain-card">
                                <div class="explain-header">
                                    <span class="explain-icon">💡</span>
                                    <span class="explain-title">第3条をわかりやすく</span>
                                </div>
                                <div class="explain-text">
                                    <strong>つまり:</strong> 半年間の契約です。やめたい時は2ヶ月前(5/31まで)に言えばOK。何もしなければ自動的にもう半年延長されます。
                                </div>
                                <div class="explain-alert">
                                    ⚠️ <strong>注意:</strong> 5/31までに連絡しないと自動更新されます
                                </div>
                            </div>

                            <!-- 契約書本文 -->
                            <div class="document">
                                <div class="doc-main-title">業務委託基本契約書</div>

                                <div class="doc-preamble">
                                    株式会社ABC（以下「甲」という）と株式会社XYZ（以下「乙」という）は、甲が乙に委託する業務に関し、以下のとおり業務委託基本契約（以下「本契約」という）を締結する。
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第1条（目的）</div>
                                    <div class="article-content">
                                        本契約は、甲が乙に対してデジタルマーケティング支援業務（以下「本業務」という）を委託し、乙がこれを受託するにあたり、甲乙間の権利義務関係を定めることを目的とする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第2条（業務内容）</div>
                                    <div class="article-content">
                                        1. 乙が甲に提供する本業務の具体的内容は、以下のとおりとする。<br>
                                        <div class="article-list">
                                            (1) Webサイトの運用・改善提案<br>
                                            (2) SNSマーケティング戦略の立案・実行<br>
                                            (3) 広告運用（リスティング広告、SNS広告等）<br>
                                            (4) 月次レポートの作成・報告<br>
                                            (5) その他、上記に付随する業務
                                        </div>
                                        2. 業務の詳細については、別途個別契約にて定めるものとする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第3条（契約期間）</div>
                                    <div class="article-content">
                                        1. 本契約の有効期間は、2026年2月1日から<span class="highlight-change">6ヶ月間</span>とする。<br>
                                        2. 本契約は、期間満了の<span class="highlight-change">2ヶ月前</span>までに当事者いずれからも書面による別段の意思表示がない場合には、同一条件にて6ヶ月間自動的に更新されるものとし、以後も同様とする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第4条（報酬）</div>
                                    <div class="article-content">
                                        1. 甲は乙に対し、本業務の対価として、月額<span class="highlight-change commented" data-comment-id="1">金48万円</span><span class="comment-indicator" onclick="showCommentThread(1)">💬 2</span>（消費税別）を支払うものとする。<br>
                                        2. 報酬の支払いは、<span class="commented" data-comment-id="2">毎月末日締め、翌月末日払い</span><span class="comment-indicator" onclick="showCommentThread(2)">💬 1</span>とする。<br>
                                        3. 振込手数料は甲の負担とする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第5条（経費）</div>
                                    <div class="article-content">
                                        本業務の遂行に必要な経費のうち、広告出稿費用その他甲が事前に承認した費用については、甲が実費を負担するものとする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第6条（秘密保持）</div>
                                    <div class="article-content">
                                        1. 甲及び乙は、本契約に関連して知り得た相手方の技術上、営業上その他の秘密情報を、相手方の事前の書面による承諾なく第三者に開示・漏洩してはならない。<br>
                                        2. 前項の義務は、<span class="commented" data-comment-id="3">本契約終了後3年間</span><span class="comment-indicator" onclick="showCommentThread(3)">💬 1</span>存続するものとする。<br>
                                        3. 次の各号に該当する情報は、秘密情報から除外する。<br>
                                        <div class="article-list">
                                            (1) 開示時点で既に公知であった情報<br>
                                            (2) 開示後、受領者の責によらず公知となった情報<br>
                                            (3) 開示時点で受領者が既に保有していた情報<br>
                                            (4) 正当な権限を有する第三者から秘密保持義務を負うことなく入手した情報
                                        </div>
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第7条（知的財産権）</div>
                                    <div class="article-content">
                                        1. 本業務の遂行により生じた成果物に関する著作権その他の知的財産権は、報酬の支払い完了をもって甲に帰属するものとする。<br>
                                        2. 乙は、成果物について著作者人格権を行使しないものとする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第8条（再委託）</div>
                                    <div class="article-content">
                                        乙は、甲の事前の書面による承諾を得ることなく、本業務の全部又は一部を第三者に再委託してはならない。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第9条（契約解除）</div>
                                    <div class="article-content">
                                        1. 甲又は乙は、相手方が次の各号のいずれかに該当した場合、何らの催告なく直ちに本契約を解除することができる。<br>
                                        <div class="article-list">
                                            (1) 本契約に違反し、相当期間を定めて催告しても是正されないとき<br>
                                            (2) 支払停止又は支払不能となったとき<br>
                                            (3) 破産手続開始、民事再生手続開始、会社更生手続開始の申立てがあったとき<br>
                                            (4) 差押え、仮差押え、仮処分又は競売の申立てがあったとき<br>
                                            (5) 解散又は営業停止となったとき
                                        </div>
                                        2. 前項により本契約が解除された場合、解除された当事者は、相手方に対し、損害賠償責任を負うものとする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第10条（損害賠償）</div>
                                    <div class="article-content">
                                        甲又は乙は、本契約に違反して相手方に損害を与えた場合、その損害を賠償する責任を負う。ただし、損害賠償の累計額は、本契約に基づき甲が乙に支払った報酬の総額を上限とする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第11条（反社会的勢力の排除）</div>
                                    <div class="article-content">
                                        1. 甲及び乙は、自己又は自己の役員が、暴力団、暴力団員、暴力団関係企業、総会屋その他の反社会的勢力（以下「反社会的勢力」という）に該当しないことを表明し、保証する。<br>
                                        2. 甲又は乙は、相手方が前項に違反した場合、何らの催告なく直ちに本契約を解除することができる。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第12条（権利義務の譲渡禁止）</div>
                                    <div class="article-content">
                                        甲及び乙は、相手方の事前の書面による承諾なく、本契約上の地位又は本契約に基づく権利義務の全部若しくは一部を第三者に譲渡し、又は担保に供してはならない。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第13条（協議事項）</div>
                                    <div class="article-content">
                                        本契約に定めのない事項又は本契約の解釈に疑義が生じた事項については、甲乙誠意をもって協議し、解決するものとする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第14条（管轄裁判所）</div>
                                    <div class="article-content">
                                        本契約に関する一切の紛争については、東京地方裁判所を第一審の専属的合意管轄裁判所とする。
                                    </div>
                                </div>

                                <!-- 署名欄 -->
                                <div class="signature-section">
                                    <div class="signature-date">
                                        本契約締結の証として、本書2通を作成し、甲乙記名押印のうえ、各1通を保有する。
                                    </div>
                                    <div class="signature-date-line">
                                        2026年　　月　　日
                                    </div>

                                    <div class="signature-parties">
                                        <div class="signature-party">
                                            <div class="party-label">【甲】</div>
                                            <div class="party-info">
                                                <div class="party-line">
                                                    <span class="party-field">住所</span>
                                                    <span class="party-value">東京都渋谷区○○1-2-3</span>
                                                </div>
                                                <div class="party-line">
                                                    <span class="party-field">会社名</span>
                                                    <span class="party-value">株式会社ABC</span>
                                                </div>
                                                <div class="party-line">
                                                    <span class="party-field">代表者</span>
                                                    <span class="party-value signature-line">代表取締役　佐藤 一郎　<span class="seal-circle">印</span></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="signature-party">
                                            <div class="party-label">【乙】</div>
                                            <div class="party-info">
                                                <div class="party-line">
                                                    <span class="party-field">住所</span>
                                                    <span class="party-value">東京都港区△△4-5-6</span>
                                                </div>
                                                <div class="party-line">
                                                    <span class="party-field">会社名</span>
                                                    <span class="party-value">株式会社XYZ</span>
                                                </div>
                                                <div class="party-line">
                                                    <span class="party-field">代表者</span>
                                                    <span class="party-value signature-line">代表取締役　田中 太郎　<span class="seal-circle">印</span></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 管理タブ -->
            <div class="tab-content" id="management">
                <div class="management-container">
                    <div class="management-grid">
                        <!-- 次のアクションカード -->
                        <div class="action-card">
                            <div class="action-header">
                                <div class="action-title">📌 次のアクション</div>
                            </div>
                            <div class="action-list">
                                <div class="action-item urgent">
                                    <div class="action-item-header">
                                        <div class="action-item-title">契約更新の判断</div>
                                        <div class="action-item-date">あと93日</div>
                                    </div>
                                    <div class="action-item-desc">5/31までに更新可否を決定</div>
                                </div>
                                <div class="action-item">
                                    <div class="action-item-header">
                                        <div class="action-item-title">月次レポート提出</div>
                                        <div class="action-item-date">2/28</div>
                                    </div>
                                    <div class="action-item-desc">1月分の実績レポートを提出</div>
                                </div>
                                <div class="action-item">
                                    <div class="action-item-header">
                                        <div class="action-item-title">請求書発行</div>
                                        <div class="action-item-date">2/28</div>
                                    </div>
                                    <div class="action-item-desc">2月分 48万円の請求書を発行</div>
                                </div>
                            </div>
                        </div>

                        <!-- 通知設定カード -->
                        <div class="action-card">
                            <div class="action-header">
                                <div class="action-title">🔔 通知設定</div>
                            </div>
                            <div class="notification-toggle">
                                <span class="toggle-label">契約更新期限の1ヶ月前に通知</span>
                                <div class="toggle-switch active" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="notification-toggle">
                                <span class="toggle-label">支払期限の3日前に通知</span>
                                <div class="toggle-switch active" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="notification-toggle">
                                <span class="toggle-label">レポート提出期限の1週間前に通知</span>
                                <div class="toggle-switch active" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="notification-toggle">
                                <span class="toggle-label">相手からメッセージが来たら通知</span>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>
                        </div>

                        <!-- 関連ドキュメントカード -->
                        <div class="action-card">
                            <div class="action-header">
                                <div class="action-title">📎 関連ドキュメント</div>
                            </div>
                            <div class="document-list">
                                <div class="document-item">
                                    <div class="document-icon">📄</div>
                                    <div class="document-info">
                                        <div class="document-name">見積書</div>
                                        <div class="document-date">2026/01/15</div>
                                    </div>
                                </div>
                                <div class="document-item">
                                    <div class="document-icon">📋</div>
                                    <div class="document-info">
                                        <div class="document-name">発注書</div>
                                        <div class="document-date">2026/01/20</div>
                                    </div>
                                </div>
                                <div class="document-item">
                                    <div class="document-icon">💰</div>
                                    <div class="document-info">
                                        <div class="document-name">請求書(1月分)</div>
                                        <div class="document-date">2026/01/31</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 契約ステータスカード -->
                        <div class="action-card">
                            <div class="action-header">
                                <div class="action-title">📊 契約ステータス</div>
                            </div>
                            <div class="contract-status-display">
                                <div class="status-icon">✅</div>
                                <div class="status-text">契約進行中</div>
                                <div class="status-dates">
                                    開始: 2026/02/01<br>
                                    満了: 2026/07/31
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右カラム: 交渉チャット -->
        <div class="right-column">
            <!-- コメントスレッドパネル -->
            <div class="comment-thread-panel" id="commentThreadPanel">
                <div class="thread-header">
                    <div class="thread-title">📍 コメントスレッド</div>
                    <button class="thread-close" onclick="closeCommentThread()">&times;</button>
                </div>
                <div class="thread-reference" id="threadReference"></div>
                <div class="thread-comments" id="threadComments"></div>
                <div class="thread-input">
                    <textarea class="thread-textarea" id="threadTextarea" placeholder="返信を入力..."></textarea>
                    <button class="thread-send-btn" onclick="sendThreadReply()">送信</button>
                </div>
            </div>

            <div class="chat-header">
                <div class="chat-header-top">
                    <div class="chat-title">💬 田中様との交渉</div>
                    <button class="chat-members-toggle" onclick="toggleMembersPanel()">
                        <span class="members-count">2</span>
                        <span class="members-icon">👥</span>
                    </button>
                </div>
                <!-- メンバーパネル -->
                <div class="members-panel" id="membersPanel">
                    <div class="members-list">
                        <div class="member-item">
                            <div class="member-avatar avatar-them">田</div>
                            <div class="member-info">
                                <div class="member-name">田中太郎</div>
                                <div class="member-company">株式会社XYZ</div>
                            </div>
                        </div>
                        <div class="member-item me">
                            <div class="member-avatar avatar-me">佐</div>
                            <div class="member-info">
                                <div class="member-name">佐藤一郎 <span class="member-you">あなた</span></div>
                                <div class="member-company">株式会社ABC</div>
                            </div>
                        </div>
                    </div>
                    <div class="members-add-section">
                        <button class="members-add-btn" onclick="openAddMemberModal()">
                            ＋ メンバーを追加
                        </button>
                    </div>
                </div>
            </div>

            <div class="messages-area" id="messages">
                <div class="message">
                    <div class="message-header">
                        <div class="message-avatar avatar-them">田</div>
                        <span class="message-sender">田中太郎</span>
                        <span class="message-time">1月28日 10:20</span>
                    </div>
                    <div class="message-bubble">
                        基本契約書のドラフトをお送りしました。ご確認お願いします。
                    </div>
                </div>

                <div class="message">
                    <div class="message-header">
                        <div class="message-avatar avatar-me">佐</div>
                        <span class="message-sender">あなた</span>
                        <span class="message-time">1月28日 11:35</span>
                    </div>
                    <div class="message-bubble">
                        確認しました!第3条の契約期間を6ヶ月でお願いできますか?
                    </div>
                </div>

                <div class="message">
                    <div class="message-header">
                        <div class="message-avatar avatar-them">田</div>
                        <span class="message-sender">田中太郎</span>
                        <span class="message-time">1月28日 14:15</span>
                    </div>
                    <div class="message-bubble">
                        承知しました!6ヶ月で問題ありません。
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-container">
                    <textarea class="input-field" id="messageInput" placeholder="メッセージを入力..." rows="2"></textarea>
                    <button class="send-btn" onclick="sendMessage()">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                            <path d="M18 2L9 11M18 2L12 18L9 11M18 2L2 8L9 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- テキスト選択ポップアップメニュー -->
    <div class="selection-popup" id="selectionPopup">
        <button class="popup-btn" onclick="aiExplain()">
            <span class="popup-icon">🤖</span>
            <span>AIで解説</span>
        </button>
        <button class="popup-btn" onclick="openCommentInput()">
            <span class="popup-icon">💬</span>
            <span>コメント</span>
        </button>
    </div>

    <!-- コメント入力モーダル -->
    <div class="modal-overlay" id="commentModal" onclick="closeCommentModal(event)">
        <div class="modal-content comment-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">💬 コメントを追加</div>
                <button class="modal-close" onclick="closeCommentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="comment-selected-text" id="commentSelectedText"></div>
                <textarea class="comment-textarea" id="commentTextarea" placeholder="コメントを入力..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeCommentModal()">キャンセル</button>
                <button class="modal-btn primary" onclick="submitComment()">コメントを送信</button>
            </div>
        </div>
    </div>

    <!-- AI解説モーダル -->
    <div class="modal-overlay" id="aiExplainModal" onclick="closeAiExplainModal(event)">
        <div class="modal-content ai-explain-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">🤖 AI解説</div>
                <button class="modal-close" onclick="closeAiExplainModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="ai-selected-text" id="aiSelectedText"></div>
                <div class="ai-explanation" id="aiExplanation">
                    <div class="ai-loading" id="aiLoading">
                        <div class="loading-spinner"></div>
                        <span>解説を生成中...</span>
                    </div>
                    <div class="ai-result" id="aiResult"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeAiExplainModal()">閉じる</button>
            </div>
        </div>
    </div>

    <!-- Wordアップロードモーダル -->
    <div class="modal-overlay" id="uploadModal" onclick="closeUploadModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">📤 Wordファイルをアップロード</div>
                <button class="modal-close" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea"
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)"
                     ondrop="handleDrop(event)">
                    <div class="upload-icon">📄</div>
                    <div class="upload-text">ファイルをドラッグ&ドロップ</div>
                    <div class="upload-subtext">または</div>
                    <label class="upload-btn">
                        ファイルを選択
                        <input type="file" accept=".docx,.doc" onchange="handleFileSelect(event)" hidden>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- 差分確認モーダル -->
    <div class="modal-overlay" id="diffModal" onclick="closeDiffModal(event)">
        <div class="modal-content diff-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">🔍 変更内容の確認</div>
                <button class="modal-close" onclick="closeDiffModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="diff-list">
                    <div class="diff-item">
                        <div class="diff-location">第3条(契約期間)</div>
                        <div class="diff-content">
                            <div class="diff-old">
                                <span class="diff-label">変更前:</span>
                                <span class="diff-text">期間満了の<span class="diff-removed">1ヶ月前</span>までに...</span>
                            </div>
                            <div class="diff-new">
                                <span class="diff-label">変更後:</span>
                                <span class="diff-text">期間満了の<span class="diff-added">2ヶ月前</span>までに...</span>
                            </div>
                        </div>
                    </div>
                    <div class="diff-item">
                        <div class="diff-location">第4条(報酬)</div>
                        <div class="diff-content">
                            <div class="diff-old">
                                <span class="diff-label">変更前:</span>
                                <span class="diff-text">月額<span class="diff-removed">45万円</span>(税別)</span>
                            </div>
                            <div class="diff-new">
                                <span class="diff-label">変更後:</span>
                                <span class="diff-text">月額<span class="diff-added">48万円</span>(税別)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeDiffModal()">キャンセル</button>
                <button class="modal-btn primary" onclick="applyChanges()">反映する</button>
            </div>
        </div>
    </div>

    <!-- 新規交渉開始ウィザード -->
    <div class="wizard-overlay" id="wizardOverlay">
        <div class="wizard-container">
            <!-- ステッパー -->
            <div class="wizard-stepper">
                <div class="stepper-item active" data-step="1">
                    <div class="stepper-circle">1</div>
                    <div class="stepper-label">契約書</div>
                </div>
                <div class="stepper-line"></div>
                <div class="stepper-item" data-step="2">
                    <div class="stepper-circle">2</div>
                    <div class="stepper-label">相手を招待</div>
                </div>
                <div class="stepper-line"></div>
                <div class="stepper-item" data-step="3">
                    <div class="stepper-circle">3</div>
                    <div class="stepper-label">確認・開始</div>
                </div>
            </div>

            <!-- Step 1: 契約書アップロード -->
            <div class="wizard-step active" id="wizardStep1">
                <div class="wizard-step-header">
                    <h2 class="wizard-step-title">📄 交渉する契約書をアップロード</h2>
                    <p class="wizard-step-desc">契約書をアップロードして交渉を始めましょう。複数の契約書をまとめてアップロードできます。</p>
                </div>

                <div class="wizard-upload-area" id="wizardUploadArea"
                     ondragover="handleWizardDragOver(event)"
                     ondragleave="handleWizardDragLeave(event)"
                     ondrop="handleWizardDrop(event)">
                    <div class="wizard-upload-icon">📎</div>
                    <div class="wizard-upload-text">ファイルをドラッグ＆ドロップ</div>
                    <div class="wizard-upload-subtext">または クリックして選択</div>
                    <div class="wizard-upload-formats">Word (.docx) / PDF 対応</div>
                    <label class="wizard-upload-btn">
                        ファイルを選択
                        <input type="file" accept=".docx,.doc,.pdf" multiple onchange="handleWizardFileSelect(event)" hidden>
                    </label>
                </div>

                <div class="wizard-files-list" id="wizardFilesList">
                    <!-- ファイルリストがここに表示される -->
                </div>
            </div>

            <!-- Step 2: 相手を招待 -->
            <div class="wizard-step" id="wizardStep2">
                <div class="wizard-step-header">
                    <h2 class="wizard-step-title">👥 交渉相手を招待</h2>
                    <p class="wizard-step-desc">メールアドレスで招待するか、招待リンクを共有してください。</p>
                </div>

                <div class="wizard-invite-section">
                    <label class="wizard-label">メールアドレスで招待</label>
                    <div class="wizard-invite-emails" id="wizardInviteEmails">
                        <!-- 招待メールリストがここに表示される -->
                    </div>
                    <div class="wizard-email-input-row">
                        <input type="email" class="wizard-email-input" id="wizardEmailInput" placeholder="メールアドレスを入力...">
                        <button class="wizard-add-email-btn" onclick="addInviteEmail()">+</button>
                    </div>
                </div>

                <div class="wizard-divider">
                    <span>または</span>
                </div>

                <div class="wizard-link-section">
                    <label class="wizard-label">🔗 招待リンクをコピー</label>
                    <div class="wizard-link-row">
                        <input type="text" class="wizard-link-input" id="wizardLinkInput" value="https://nego.app/join/x7k2mP9qL..." readonly>
                        <button class="wizard-copy-btn" onclick="copyInviteLink()">📋 コピー</button>
                    </div>
                    <p class="wizard-link-note">💡 招待された方は契約書を閲覧できます。編集・合意にはサインインが必要です。</p>
                </div>
            </div>

            <!-- Step 3: 確認・開始 -->
            <div class="wizard-step" id="wizardStep3">
                <div class="wizard-step-header">
                    <h2 class="wizard-step-title">✨ 交渉を開始する準備ができました</h2>
                    <p class="wizard-step-desc">以下の内容で交渉を開始します。</p>
                </div>

                <div class="wizard-summary">
                    <div class="wizard-summary-section">
                        <div class="wizard-summary-label">📄 契約書</div>
                        <ul class="wizard-summary-list" id="wizardSummaryFiles">
                            <!-- ファイルリストがここに表示される -->
                        </ul>
                    </div>

                    <div class="wizard-summary-section">
                        <div class="wizard-summary-label">👥 招待</div>
                        <ul class="wizard-summary-list" id="wizardSummaryInvites">
                            <!-- 招待リストがここに表示される -->
                        </ul>
                    </div>
                </div>

                <div class="wizard-start-note">
                    開始すると、招待した方にメールが送信されます。
                </div>
            </div>

            <!-- ウィザードフッター -->
            <div class="wizard-footer">
                <button class="wizard-btn secondary" id="wizardBackBtn" onclick="wizardBack()" style="display: none;">
                    ← 戻る
                </button>
                <div class="wizard-footer-spacer"></div>
                <button class="wizard-btn secondary" onclick="closeWizard()">キャンセル</button>
                <button class="wizard-btn primary" id="wizardNextBtn" onclick="wizardNext()">
                    次へ →
                </button>
            </div>
        </div>
    </div>

    <!-- 招待された側のランディング画面 -->
    <div class="invite-landing-overlay" id="inviteLandingOverlay">
        <div class="invite-landing-container">
            <div class="invite-landing-header">
                <div class="invite-landing-logo">📝 ContractNego</div>
            </div>

            <div class="invite-landing-content">
                <div class="invite-landing-card">
                    <div class="invite-landing-title">📄 業務委託基本契約書</div>
                    <div class="invite-landing-sender">
                        <div class="invite-sender-avatar">佐</div>
                        <div class="invite-sender-info">
                            <div class="invite-sender-name">佐藤 一郎さん</div>
                            <div class="invite-sender-company">株式会社ABC</div>
                        </div>
                        <div class="invite-sender-action">があなたを交渉に招待しました</div>
                    </div>

                    <!-- 契約書プレビュー -->
                    <div class="invite-preview-container">
                        <div class="invite-preview-label">契約書プレビュー</div>
                        <div class="invite-preview-content" id="invitePreviewContent">
                            <div class="invite-preview-title">業務委託基本契約書</div>
                            <div class="invite-preview-text">
                                株式会社ABC（以下「甲」という）と株式会社XYZ（以下「乙」という）は、甲が乙に委託する業務に関し、以下のとおり業務委託基本契約（以下「本契約」という）を締結する。
                            </div>
                            <div class="invite-preview-article">
                                <div class="invite-preview-article-title">第1条（目的）</div>
                                <div class="invite-preview-article-text">
                                    本契約は、甲が乙に対してデジタルマーケティング支援業務（以下「本業務」という）を委託し、乙がこれを受託するにあたり、甲乙間の権利義務関係を定めることを目的とする。
                                </div>
                            </div>
                            <div class="invite-preview-fade"></div>
                        </div>
                    </div>

                    <div class="invite-action-divider">
                        <span>コメント・編集・合意するにはサインインが必要です</span>
                    </div>

                    <div class="invite-auth-buttons">
                        <button class="invite-auth-btn google" onclick="signInWithGoogle()">
                            <svg class="google-icon" viewBox="0 0 24 24" width="20" height="20">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Googleでサインイン
                        </button>
                        <button class="invite-auth-btn microsoft" onclick="signInWithMicrosoft()">
                            <svg class="microsoft-icon" viewBox="0 0 24 24" width="20" height="20">
                                <path fill="#F25022" d="M1 1h10v10H1z"/>
                                <path fill="#00A4EF" d="M1 13h10v10H1z"/>
                                <path fill="#7FBA00" d="M13 1h10v10H13z"/>
                                <path fill="#FFB900" d="M13 13h10v10H13z"/>
                            </svg>
                            Microsoftでサインイン
                        </button>
                    </div>

                    <div class="invite-footer-note">
                        💼 ビジネスアカウントでのサインインを推奨します
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- メンバー追加モーダル -->
    <div class="modal-overlay" id="addMemberModal" onclick="closeAddMemberModal(event)">
        <div class="modal-content add-member-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">👥 メンバーを追加</div>
                <button class="modal-close" onclick="closeAddMemberModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="add-member-section">
                    <label class="add-member-label">メールアドレスで招待</label>
                    <div class="add-member-input-row">
                        <input type="email" class="add-member-input" id="addMemberEmailInput" placeholder="メールアドレスを入力...">
                        <button class="add-member-send-btn" onclick="sendMemberInvite()">招待</button>
                    </div>
                </div>

                <div class="add-member-divider">
                    <span>または</span>
                </div>

                <div class="add-member-section">
                    <label class="add-member-label">🔗 招待リンクをコピー</label>
                    <div class="add-member-link-row">
                        <input type="text" class="add-member-link-input" id="addMemberLinkInput" value="https://nego.app/join/abc123xyz..." readonly>
                        <button class="add-member-copy-btn" onclick="copyMemberInviteLink()">📋</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 交渉一覧画面 -->
    <div class="negotiations-list-overlay" id="negotiationsListOverlay">
        <div class="negotiations-list-container">
            <!-- ヘッダー -->
            <div class="negotiations-header">
                <div class="negotiations-logo">📝 ContractNego</div>
                <button class="negotiations-new-btn" onclick="closeNegotiationsList(); openWizard();">
                    ＋ 新しい交渉を始める
                </button>
            </div>

            <!-- 検索・フィルター -->
            <div class="negotiations-toolbar">
                <div class="negotiations-search">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="negotiations-search-input" placeholder="契約書名、相手先で検索...">
                </div>
                <div class="negotiations-filters">
                    <select class="negotiations-filter-select">
                        <option value="all">すべて</option>
                        <option value="negotiating">交渉中</option>
                        <option value="waiting">返答待ち</option>
                        <option value="agreed">合意済み</option>
                    </select>
                    <select class="negotiations-filter-select">
                        <option value="recent">最新順</option>
                        <option value="oldest">古い順</option>
                        <option value="name">名前順</option>
                    </select>
                </div>
            </div>

            <!-- 交渉リスト -->
            <div class="negotiations-content">
                <!-- 交渉中セクション -->
                <div class="negotiations-section">
                    <div class="negotiations-section-header">
                        <span class="negotiations-section-icon">💬</span>
                        <span class="negotiations-section-title">交渉中</span>
                        <span class="negotiations-section-count">2</span>
                    </div>
                    <div class="negotiations-cards">
                        <!-- カード1 -->
                        <div class="negotiation-card" onclick="closeNegotiationsList()">
                            <div class="negotiation-card-header">
                                <div class="negotiation-card-icon">📄</div>
                                <div class="negotiation-card-title">業務委託基本契約書</div>
                                <div class="negotiation-card-badge negotiating">交渉中</div>
                            </div>
                            <div class="negotiation-card-meta">
                                <span class="negotiation-card-partner">株式会社XYZ 田中様</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-date">最終更新: 1月28日 14:15</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-version">Ver.8</span>
                            </div>
                            <div class="negotiation-card-activity">
                                <div class="activity-avatar avatar-them">田</div>
                                <div class="activity-text">「承知しました!6ヶ月で問題ありません。」</div>
                            </div>
                        </div>
                        <!-- カード2 -->
                        <div class="negotiation-card">
                            <div class="negotiation-card-header">
                                <div class="negotiation-card-icon">📄</div>
                                <div class="negotiation-card-title">秘密保持契約書</div>
                                <div class="negotiation-card-badge waiting">返答待ち</div>
                            </div>
                            <div class="negotiation-card-meta">
                                <span class="negotiation-card-partner">株式会社DEF 山田様</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-date">最終更新: 1月25日 10:30</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-version">Ver.3</span>
                            </div>
                            <div class="negotiation-card-activity">
                                <div class="activity-icon">📝</div>
                                <div class="activity-text">相手がドラフトを確認中</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 合意済みセクション -->
                <div class="negotiations-section">
                    <div class="negotiations-section-header">
                        <span class="negotiations-section-icon">✅</span>
                        <span class="negotiations-section-title">合意済み</span>
                        <span class="negotiations-section-count">2</span>
                    </div>
                    <div class="negotiations-cards">
                        <!-- カード3 -->
                        <div class="negotiation-card agreed">
                            <div class="negotiation-card-header">
                                <div class="negotiation-card-icon">📄</div>
                                <div class="negotiation-card-title">システム開発契約書</div>
                                <div class="negotiation-card-badge agreed">✅ 合意済み</div>
                            </div>
                            <div class="negotiation-card-meta">
                                <span class="negotiation-card-partner">株式会社GHI 鈴木様</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-date">合意日: 2024年12月15日</span>
                            </div>
                        </div>
                        <!-- カード4 -->
                        <div class="negotiation-card agreed">
                            <div class="negotiation-card-header">
                                <div class="negotiation-card-icon">📄</div>
                                <div class="negotiation-card-title">コンサルティング契約書</div>
                                <div class="negotiation-card-badge agreed">✅ 合意済み</div>
                            </div>
                            <div class="negotiation-card-meta">
                                <span class="negotiation-card-partner">株式会社JKL 高橋様</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-date">合意日: 2024年11月20日</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- デモ用: 新規交渉開始ボタン（ヘッダーに追加するトリガー） -->
    <button class="demo-trigger-btn" id="demoTriggerBtn" onclick="openWizard()">
        ＋ 新しい交渉を始める
    </button>
    <button class="demo-trigger-btn invite-demo" id="demoInviteTriggerBtn" onclick="openInviteLanding()">
        📩 招待された側を体験
    </button>
    <button class="demo-trigger-btn list-demo" id="demoListTriggerBtn" onclick="openNegotiationsList()">
        📋 交渉一覧を見る
    </button>

    <script src="script.js"></script>
</body>
</html>
