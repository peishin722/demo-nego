<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>契約交渉プラットフォーム</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ヘッダー -->
    <div class="header">
        <div class="header-left">
            <div class="contract-title">業務委託基本契約書</div>
            <span class="partner-badge">株式会社XYZ 田中様</span>
        </div>
        <div class="header-actions">
            <button class="header-btn primary agree-btn" id="agreeBtn" onclick="agreeContract()">
                ✅ この内容で合意
            </button>
        </div>
    </div>

    <!-- メインコンテナ(2カラム) -->
    <div class="main-wrapper">
        <!-- 左カラム -->
        <div class="left-column">
            <!-- メインタブ -->
            <div class="main-tabs">
                <button class="main-tab active" onclick="switchMainTab('overview')">
                    <span>📊</span>
                    <span>概要</span>
                </button>
                <button class="main-tab" onclick="switchMainTab('contract')">
                    <span>📄</span>
                    <span>契約書</span>
                </button>
                <button class="main-tab" onclick="switchMainTab('management')">
                    <span>📅</span>
                    <span>管理</span>
                </button>
            </div>

            <!-- 概要タブ -->
            <div class="tab-content active" id="overview">
                <div class="overview-container">
                    <!-- この契約の要点カード -->
                    <div class="summary-card key-points-card">
                        <div class="card-header">
                            <div class="card-icon">🎯</div>
                            <div class="card-title">この契約の要点</div>
                        </div>
                        <div class="key-points-content">
                            <ul class="key-points-list">
                                <li>ABC社がXYZ社にマーケティング支援を提供する契約です</li>
                                <li>期間は6ヶ月間、月額48万円の報酬</li>
                                <li>問題なければ自動更新される形式</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 人・モノ・金の流れ図 -->
                    <div class="summary-card">
                        <div class="card-header">
                            <div class="card-icon">📈</div>
                            <div class="card-title">人・モノ・金の流れ</div>
                        </div>
                        <div class="flow-section">
                            <div class="flow-diagram">
                                <div class="flow-node">
                                    <div class="flow-box">ABC社<br><span class="flow-sub">(あなたの会社)</span></div>
                                </div>
                                <div class="flow-arrow-container">
                                    <div class="flow-arrow-line"></div>
                                    <div class="flow-arrow-label">サービス提供</div>
                                    <div class="flow-arrow-head">→</div>
                                </div>
                                <div class="flow-node">
                                    <div class="flow-box partner">XYZ社<br><span class="flow-sub">(田中様)</span></div>
                                </div>
                            </div>
                            <div class="flow-diagram">
                                <div class="flow-node">
                                    <div class="flow-box partner">XYZ社<br><span class="flow-sub">(田中様)</span></div>
                                </div>
                                <div class="flow-arrow-container">
                                    <div class="flow-arrow-line reverse"></div>
                                    <div class="flow-arrow-label money">月48万円</div>
                                    <div class="flow-arrow-head">→</div>
                                </div>
                                <div class="flow-node">
                                    <div class="flow-box">ABC社<br><span class="flow-sub">(あなたの会社)</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- タイムラインカード -->
                    <div class="summary-card">
                        <div class="card-header">
                            <div class="card-icon">📅</div>
                            <div class="card-title">これからのタイムライン</div>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item success">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">2026年2月1日</div>
                                    <div class="timeline-title">契約開始</div>
                                </div>
                            </div>
                            <div class="timeline-item warning">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">2026年5月31日</div>
                                    <div class="timeline-title">⚠️ 契約更新判断期限</div>
                                    <div class="timeline-alert">この日までに連絡しないと自動更新</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">2026年7月31日</div>
                                    <div class="timeline-title">契約満了</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 契約書タブ -->
            <div class="tab-content" id="contract">
                <div class="contract-container">
                    <!-- ステータスバー -->
                    <div class="contract-status-bar">
                        <div class="status-left">
                            <span class="status-badge" id="contractStatusBadge">💬 交渉中</span>
                        </div>
                        <div class="status-right">
                            <button class="status-action-btn" id="editLockBtn" onclick="toggleEditLock()">
                                📝 Wordで編集
                            </button>
                            <button class="status-action-btn" onclick="openUploadModal()">📤 アップロード</button>
                            <button class="status-action-btn" onclick="downloadWord()">📥 ダウンロード</button>
                        </div>
                    </div>

                    <!-- 契約書サブタブ -->
                    <div class="contract-subtabs">
                        <button class="contract-subtab active" onclick="switchContractSubtab('basic')">
                            📄 基本契約書
                        </button>
                        <button class="contract-subtab" onclick="switchContractSubtab('individual-a')">
                            📋 個別契約(案件A)
                        </button>
                        <button class="add-contract-subtab" onclick="addNewContract()">
                            + 新規追加
                        </button>
                    </div>

                    <!-- 契約書コンテンツ -->
                    <div class="contract-content-area">
                        <div class="contract-content-inner">
                            <!-- AI解説カード -->
                            <div class="ai-explain-card">
                                <div class="explain-header">
                                    <span class="explain-icon">💡</span>
                                    <span class="explain-title">第3条をわかりやすく</span>
                                </div>
                                <div class="explain-text">
                                    <strong>つまり:</strong> 半年間の契約です。やめたい時は2ヶ月前(5/31まで)に言えばOK。何もしなければ自動的にもう半年延長されます。
                                </div>
                                <div class="explain-alert">
                                    ⚠️ <strong>注意:</strong> 5/31までに連絡しないと自動更新されます
                                </div>
                            </div>

                            <!-- 契約書本文 -->
                            <div class="document">
                                <div class="doc-main-title">業務委託基本契約書</div>

                                <div class="doc-article">
                                    <div class="article-title">第1条(契約の目的)</div>
                                    <div class="article-content">
                                        本契約は、甲が乙に対して、デジタルマーケティング支援業務を提供することを目的とする。
                                    </div>
                                </div>

                                <div class="doc-article">
                                    <div class="article-title">第3条(契約期間)</div>
                                    <div class="article-content">
                                        本契約の有効期間は、2026年2月1日から<span class="highlight-change">6ヶ月間</span>とする。<br>
                                        本契約は、期間満了の<span class="highlight-change">2ヶ月前</span>までに当事者いずれからも書面による別段の意思表示がない場合には、同一条件にて6ヶ月間自動的に更新されるものとする。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 管理タブ -->
            <div class="tab-content" id="management">
                <div class="management-container">
                    <div class="management-grid">
                        <!-- 次のアクションカード -->
                        <div class="action-card">
                            <div class="action-header">
                                <div class="action-title">📌 次のアクション</div>
                            </div>
                            <div class="action-list">
                                <div class="action-item urgent">
                                    <div class="action-item-header">
                                        <div class="action-item-title">契約更新の判断</div>
                                        <div class="action-item-date">あと93日</div>
                                    </div>
                                    <div class="action-item-desc">5/31までに更新可否を決定</div>
                                </div>
                                <div class="action-item">
                                    <div class="action-item-header">
                                        <div class="action-item-title">月次レポート提出</div>
                                        <div class="action-item-date">2/28</div>
                                    </div>
                                    <div class="action-item-desc">1月分の実績レポートを提出</div>
                                </div>
                                <div class="action-item">
                                    <div class="action-item-header">
                                        <div class="action-item-title">請求書発行</div>
                                        <div class="action-item-date">2/28</div>
                                    </div>
                                    <div class="action-item-desc">2月分 48万円の請求書を発行</div>
                                </div>
                            </div>
                        </div>

                        <!-- 通知設定カード -->
                        <div class="action-card">
                            <div class="action-header">
                                <div class="action-title">🔔 通知設定</div>
                            </div>
                            <div class="notification-toggle">
                                <span class="toggle-label">契約更新期限の1ヶ月前に通知</span>
                                <div class="toggle-switch active" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="notification-toggle">
                                <span class="toggle-label">支払期限の3日前に通知</span>
                                <div class="toggle-switch active" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="notification-toggle">
                                <span class="toggle-label">レポート提出期限の1週間前に通知</span>
                                <div class="toggle-switch active" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="notification-toggle">
                                <span class="toggle-label">相手からメッセージが来たら通知</span>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>
                        </div>

                        <!-- 関連ドキュメントカード -->
                        <div class="action-card">
                            <div class="action-header">
                                <div class="action-title">📎 関連ドキュメント</div>
                            </div>
                            <div class="document-list">
                                <div class="document-item">
                                    <div class="document-icon">📄</div>
                                    <div class="document-info">
                                        <div class="document-name">見積書</div>
                                        <div class="document-date">2026/01/15</div>
                                    </div>
                                </div>
                                <div class="document-item">
                                    <div class="document-icon">📋</div>
                                    <div class="document-info">
                                        <div class="document-name">発注書</div>
                                        <div class="document-date">2026/01/20</div>
                                    </div>
                                </div>
                                <div class="document-item">
                                    <div class="document-icon">💰</div>
                                    <div class="document-info">
                                        <div class="document-name">請求書(1月分)</div>
                                        <div class="document-date">2026/01/31</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 契約ステータスカード -->
                        <div class="action-card">
                            <div class="action-header">
                                <div class="action-title">📊 契約ステータス</div>
                            </div>
                            <div class="contract-status-display">
                                <div class="status-icon">✅</div>
                                <div class="status-text">契約進行中</div>
                                <div class="status-dates">
                                    開始: 2026/02/01<br>
                                    満了: 2026/07/31
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右カラム: 交渉チャット -->
        <div class="right-column">
            <div class="chat-header">
                <div class="chat-title">💬 田中様との交渉</div>
            </div>

            <div class="messages-area" id="messages">
                <div class="message">
                    <div class="message-header">
                        <div class="message-avatar avatar-them">田</div>
                        <span class="message-sender">田中太郎</span>
                        <span class="message-time">1月28日 10:20</span>
                    </div>
                    <div class="message-bubble">
                        基本契約書のドラフトをお送りしました。ご確認お願いします。
                    </div>
                </div>

                <div class="message">
                    <div class="message-header">
                        <div class="message-avatar avatar-me">佐</div>
                        <span class="message-sender">あなた</span>
                        <span class="message-time">1月28日 11:35</span>
                    </div>
                    <div class="message-bubble">
                        確認しました!第3条の契約期間を6ヶ月でお願いできますか?
                    </div>
                </div>

                <div class="message">
                    <div class="message-header">
                        <div class="message-avatar avatar-them">田</div>
                        <span class="message-sender">田中太郎</span>
                        <span class="message-time">1月28日 14:15</span>
                    </div>
                    <div class="message-bubble">
                        承知しました!6ヶ月で問題ありません。
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-container">
                    <textarea class="input-field" id="messageInput" placeholder="メッセージを入力..." rows="2"></textarea>
                    <button class="send-btn" onclick="sendMessage()">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                            <path d="M18 2L9 11M18 2L12 18L9 11M18 2L2 8L9 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Wordアップロードモーダル -->
    <div class="modal-overlay" id="uploadModal" onclick="closeUploadModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">📤 Wordファイルをアップロード</div>
                <button class="modal-close" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea"
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)"
                     ondrop="handleDrop(event)">
                    <div class="upload-icon">📄</div>
                    <div class="upload-text">ファイルをドラッグ&ドロップ</div>
                    <div class="upload-subtext">または</div>
                    <label class="upload-btn">
                        ファイルを選択
                        <input type="file" accept=".docx,.doc" onchange="handleFileSelect(event)" hidden>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- 差分確認モーダル -->
    <div class="modal-overlay" id="diffModal" onclick="closeDiffModal(event)">
        <div class="modal-content diff-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">🔍 変更内容の確認</div>
                <button class="modal-close" onclick="closeDiffModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="diff-list">
                    <div class="diff-item">
                        <div class="diff-location">第3条(契約期間)</div>
                        <div class="diff-content">
                            <div class="diff-old">
                                <span class="diff-label">変更前:</span>
                                <span class="diff-text">期間満了の<span class="diff-removed">1ヶ月前</span>までに...</span>
                            </div>
                            <div class="diff-new">
                                <span class="diff-label">変更後:</span>
                                <span class="diff-text">期間満了の<span class="diff-added">2ヶ月前</span>までに...</span>
                            </div>
                        </div>
                    </div>
                    <div class="diff-item">
                        <div class="diff-location">第4条(報酬)</div>
                        <div class="diff-content">
                            <div class="diff-old">
                                <span class="diff-label">変更前:</span>
                                <span class="diff-text">月額<span class="diff-removed">45万円</span>(税別)</span>
                            </div>
                            <div class="diff-new">
                                <span class="diff-label">変更後:</span>
                                <span class="diff-text">月額<span class="diff-added">48万円</span>(税別)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeDiffModal()">キャンセル</button>
                <button class="modal-btn primary" onclick="applyChanges()">反映する</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
