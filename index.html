<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交渉一覧 - ContractNego</title>
    <link rel="icon" href="favicon-32.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="hubble-design-tokens.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="page-list">
    <!-- 交渉一覧画面 -->
    <div class="negotiations-list-page">
        <div class="negotiations-list-container">
    <!-- ヘッダー -->
            <div class="negotiations-header">
                <img src="hubble-logo.svg" alt="Hubble" class="negotiations-logo">
                <button class="negotiations-new-btn" onclick="showWizard()">
                    <span class="material-symbols-outlined icon-sm">add</span> 新しい交渉を始める
                </button>
            </div>

            <!-- 検索・フィルター -->
            <div class="negotiations-toolbar">
                <div class="negotiations-search">
                    <span class="search-icon material-symbols-outlined">search</span>
                    <input type="text" class="negotiations-search-input" placeholder="契約書名、相手先で検索...">
                        </div>
                <div class="negotiations-filters">
                    <select class="negotiations-filter-select">
                        <option value="all">すべて</option>
                        <option value="negotiating">交渉中</option>
                        <option value="waiting">返答待ち</option>
                        <option value="agreed">合意済み</option>
                    </select>
                    <select class="negotiations-filter-select">
                        <option value="recent">最新順</option>
                        <option value="oldest">古い順</option>
                        <option value="name">名前順</option>
                    </select>
                </div>
            </div>

            <!-- 交渉リスト -->
            <div class="negotiations-content">
                <!-- 交渉中セクション -->
                <div class="negotiations-section">
                    <div class="negotiations-section-header">
                        <span class="negotiations-section-icon material-symbols-outlined">forum</span>
                        <span class="negotiations-section-title">交渉中</span>
                        <span class="negotiations-section-count">2</span>
                    </div>
                    <div class="negotiations-cards">
                        <!-- カード1 -->
                        <div class="negotiation-card" onclick="location.href='negotiation.html'">
                            <div class="negotiation-card-header">
                                <div class="negotiation-card-icon"><span class="material-symbols-outlined">description</span></div>
                                <div class="negotiation-card-title">業務委託基本契約書</div>
                                <div class="negotiation-card-badge negotiating">交渉中</div>
                            </div>
                            <div class="negotiation-card-meta">
                                <span class="negotiation-card-partner">株式会社XYZ 田中様</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-date">最終更新: 1月28日 14:15</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-version">Ver.8</span>
                            </div>
                            <div class="negotiation-card-activity">
                                <div class="activity-avatar avatar-them">田</div>
                                <div class="activity-text">「承知しました!6ヶ月で問題ありません。」</div>
                            </div>
                        </div>
                        <!-- カード2 -->
                        <div class="negotiation-card">
                            <div class="negotiation-card-header">
                                <div class="negotiation-card-icon"><span class="material-symbols-outlined">description</span></div>
                                <div class="negotiation-card-title">秘密保持契約書</div>
                                <div class="negotiation-card-badge waiting">返答待ち</div>
                                </div>
                            <div class="negotiation-card-meta">
                                <span class="negotiation-card-partner">株式会社DEF 山田様</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-date">最終更新: 1月25日 10:30</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-version">Ver.3</span>
                            </div>
                            <div class="negotiation-card-activity">
                                <div class="activity-icon"><span class="material-symbols-outlined icon-sm">edit_note</span></div>
                                <div class="activity-text">相手がドラフトを確認中</div>
                        </div>
                    </div>
                </div>
            </div>

                <!-- 合意済みセクション -->
                <div class="negotiations-section">
                    <div class="negotiations-section-header">
                        <span class="negotiations-section-icon material-symbols-outlined">check_circle</span>
                        <span class="negotiations-section-title">合意済み</span>
                        <span class="negotiations-section-count">2</span>
                            </div>
                    <div class="negotiations-cards">
                        <!-- カード3 -->
                        <div class="negotiation-card agreed">
                            <div class="negotiation-card-header">
                                <div class="negotiation-card-icon"><span class="material-symbols-outlined">description</span></div>
                                <div class="negotiation-card-title">システム開発契約書</div>
                                <div class="negotiation-card-badge agreed"><span class="material-symbols-outlined icon-xs">check_circle</span> 合意済み</div>
                            </div>
                            <div class="negotiation-card-meta">
                                <span class="negotiation-card-partner">株式会社GHI 鈴木様</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-date">合意日: 2024年12月15日</span>
                            </div>
                        </div>
                        <!-- カード4 -->
                        <div class="negotiation-card agreed">
                            <div class="negotiation-card-header">
                                <div class="negotiation-card-icon"><span class="material-symbols-outlined">description</span></div>
                                <div class="negotiation-card-title">コンサルティング契約書</div>
                                <div class="negotiation-card-badge agreed"><span class="material-symbols-outlined icon-xs">check_circle</span> 合意済み</div>
                            </div>
                            <div class="negotiation-card-meta">
                                <span class="negotiation-card-partner">株式会社JKL 高橋様</span>
                                <span class="negotiation-card-separator">·</span>
                                <span class="negotiation-card-date">合意日: 2024年11月20日</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 新規交渉開始ウィザード（白背景フルページ） -->
    <div class="wizard-page" id="wizardPage">
        <div class="wizard-page-container">
            <!-- ヘッダー -->
            <div class="wizard-page-header">
                <img src="hubble-logo.svg" alt="Hubble" class="wizard-page-logo">
                <button class="wizard-close-btn" onclick="hideWizard()">&times;</button>
            </div>

            <!-- ステッパー -->
            <div class="wizard-stepper">
                <div class="stepper-item active" data-step="1">
                    <div class="stepper-circle">1</div>
                    <div class="stepper-label">契約書</div>
                </div>
                <div class="stepper-line"></div>
                <div class="stepper-item" data-step="2">
                    <div class="stepper-circle">2</div>
                    <div class="stepper-label">相手を招待</div>
                </div>
                <div class="stepper-line"></div>
                <div class="stepper-item" data-step="3">
                    <div class="stepper-circle">3</div>
                    <div class="stepper-label">確認・開始</div>
                </div>
            </div>

            <!-- Step 1: 契約書アップロード -->
            <div class="wizard-step active" id="wizardStep1">
                <div class="wizard-step-header">
                    <h2 class="wizard-step-title"><span class="material-symbols-outlined">description</span> 交渉する契約書をアップロード</h2>
                    <p class="wizard-step-desc">契約書をアップロードして交渉を始めましょう。複数の契約書をまとめてアップロードできます。</p>
                </div>

                <div class="wizard-upload-area" id="wizardUploadArea"
                     ondragover="handleWizardDragOver(event)"
                     ondragleave="handleWizardDragLeave(event)"
                     ondrop="handleWizardDrop(event)">
                    <div class="wizard-upload-icon"><span class="material-symbols-outlined icon-xl">attach_file</span></div>
                    <div class="wizard-upload-text">ファイルをドラッグ＆ドロップ</div>
                    <div class="wizard-upload-subtext">または クリックして選択</div>
                    <div class="wizard-upload-formats">Word (.docx) / PDF 対応</div>
                    <label class="wizard-upload-btn">
                        ファイルを選択
                        <input type="file" accept=".docx,.doc,.pdf" multiple onchange="handleWizardFileSelect(event)" hidden>
                    </label>
                </div>

                <div class="wizard-files-list" id="wizardFilesList">
                    <!-- ファイルリストがここに表示される -->
                </div>
            </div>

            <!-- Step 2: 相手を招待 -->
            <div class="wizard-step" id="wizardStep2">
                <div class="wizard-step-header">
                    <h2 class="wizard-step-title"><span class="material-symbols-outlined">group_add</span> 交渉相手を招待</h2>
                    <p class="wizard-step-desc">メールアドレスで招待するか、招待リンクを共有してください。</p>
                </div>

                <!-- 権限選択 -->
                <div class="wizard-permission-section">
                    <label class="wizard-label">この相手の権限</label>
                    <div class="wizard-permission-selector">
                        <label class="wizard-permission-option selected" data-permission="signer">
                            <input type="radio" name="invitePermission" value="signer" checked>
                            <div class="wizard-permission-content">
                                <div class="wizard-permission-icon"><span class="material-symbols-outlined">key</span></div>
                                <div class="wizard-permission-info">
                                    <div class="wizard-permission-title">合意権限あり</div>
                                    <div class="wizard-permission-desc">契約への合意が可能</div>
                                </div>
                            </div>
                            <div class="wizard-permission-check"><span class="material-symbols-outlined icon-sm">check</span></div>
                        </label>
                        <label class="wizard-permission-option" data-permission="member">
                            <input type="radio" name="invitePermission" value="member">
                            <div class="wizard-permission-content">
                                <div class="wizard-permission-icon"><span class="material-symbols-outlined">person</span></div>
                                <div class="wizard-permission-info">
                                    <div class="wizard-permission-title">メンバー</div>
                                    <div class="wizard-permission-desc">閲覧・編集・コメントのみ</div>
                                </div>
                            </div>
                            <div class="wizard-permission-check"><span class="material-symbols-outlined icon-sm">check</span></div>
                        </label>
                    </div>
                </div>

                <div class="wizard-invite-section">
                    <label class="wizard-label">メールアドレスで招待</label>
                    <div class="wizard-invite-emails" id="wizardInviteEmails">
                        <!-- 招待メールリストがここに表示される -->
                    </div>
                    <div class="wizard-email-input-row">
                        <input type="email" class="wizard-email-input" id="wizardEmailInput" placeholder="メールアドレスを入力...">
                        <button class="wizard-add-email-btn" onclick="addInviteEmail()">+</button>
                    </div>
                </div>

                <div class="wizard-divider">
                    <span>または</span>
                </div>

                <div class="wizard-link-section">
                    <label class="wizard-label"><span class="material-symbols-outlined icon-sm">link</span> 招待リンクをコピー</label>
                    <div class="wizard-link-row">
                        <input type="text" class="wizard-link-input" id="wizardLinkInput" value="https://nego.app/join/x7k2mP9qL..." readonly>
                        <button class="wizard-copy-btn" onclick="copyInviteLink()"><span class="material-symbols-outlined icon-sm">content_copy</span> コピー</button>
                    </div>
                    <p class="wizard-link-note"><span class="material-symbols-outlined icon-sm">lightbulb</span> 招待された方は契約書を閲覧できます。編集・合意にはサインインが必要です。</p>
                </div>
            </div>

            <!-- Step 3: 確認・開始 -->
            <div class="wizard-step" id="wizardStep3">
                <div class="wizard-step-header">
                    <h2 class="wizard-step-title"><span class="material-symbols-outlined">auto_awesome</span> 交渉を開始する準備ができました</h2>
                    <p class="wizard-step-desc">以下の内容で交渉を開始します。</p>
                </div>

                <div class="wizard-summary">
                    <div class="wizard-summary-section">
                        <div class="wizard-summary-label"><span class="material-symbols-outlined icon-sm">description</span> 契約書</div>
                        <ul class="wizard-summary-list" id="wizardSummaryFiles">
                            <!-- ファイルリストがここに表示される -->
                        </ul>
                    </div>

                    <div class="wizard-summary-section">
                        <div class="wizard-summary-label"><span class="material-symbols-outlined icon-sm">group</span> 招待</div>
                        <ul class="wizard-summary-list" id="wizardSummaryInvites">
                            <!-- 招待リストがここに表示される -->
                        </ul>
                    </div>
                </div>

                <div class="wizard-start-note">
                    開始すると、招待した方にメールが送信されます。
                </div>
            </div>

            <!-- ウィザードフッター -->
            <div class="wizard-footer">
                <button class="wizard-btn secondary" id="wizardBackBtn" onclick="wizardBack()" style="display: none;">
                    <span class="material-symbols-outlined icon-sm">chevron_left</span> 戻る
                </button>
                <div class="wizard-footer-spacer"></div>
                <button class="wizard-btn secondary" onclick="hideWizard()">キャンセル</button>
                <button class="wizard-btn primary" id="wizardNextBtn" onclick="wizardNext()">
                    次へ <span class="material-symbols-outlined icon-sm">chevron_right</span>
                </button>
            </div>
        </div>
    </div>

    <!-- デモ用: LPを見るボタン -->
    <a href="website.html" class="demo-trigger-btn website-demo">
        <span class="material-symbols-outlined icon-sm">language</span> サービスサイトを見る
    </a>

    <!-- デモ用: 招待された側を体験ボタン -->
    <a href="invite.html" class="demo-trigger-btn invite-demo">
        <span class="material-symbols-outlined icon-sm">mail</span> 招待された側を体験
    </a>

    <script src="script.js"></script>
</body>
</html>
